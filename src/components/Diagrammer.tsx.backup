'use client';

import React, { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { QuickEditor } from './QuickEditorNew';
import {
  Box,
  Plus,
  Link2,
  ZoomIn,
  ZoomOut,
  Maximize2,
  Save,
  Lock,
  Unlock,
  Table2,
  Edit3,
  Eye,
  Settings,
  ChevronRight,
  ChevronDown,
  Database,
  FileText,
  RefreshCw,
  GitCompare,
  ArrowRightLeft,
  Trash2,
  Copy,
  Download,
  Upload,
  Undo2,
  Redo2,
  MousePointer2,
  Move,
  Type,
  Square,
  Circle,
  Component,
  Workflow,
  GitBranch,
  GitMerge,
  Network,
  EyeOff,
  Hash,
  Key,
  Zap,
  Command,
  Users,
  User,
  Crown,
  UserPlus,
  KeyRound,
  Server,
  Search,
  Link as LinkIcon,
  Folder,
  Globe,
  Archive,
  FileCode,
  MoreHorizontal,
  Sun,
  Moon,
  MousePointer,
  StickyNote,
  Group,
  Ungroup,
  Shapes,
  ArrowRight,
  Hand,
  Grid,
  Target,
  Sparkles,
  Map,
  Expand,
  Minimize2
} from 'lucide-react';

// Types
type ViewMode = 'diagram' | 'quick-editor' | 'properties';
type Tool = 'select' | 'table' | 'relationship' | 'note' | 'move';
type EditorViewMode = 'table-list' | 'table-editor';
type TableEditorTab = 'columns' | 'indexes' | 'foreignKeys' | 'constraints' | 'businessTerms' | 'triggers';

interface TableIndex {
  id: string;
  name: string;
  columns: string[];
  isUnique: boolean;
  type: 'CLUSTERED' | 'NONCLUSTERED' | 'HASH';
}

interface ForeignKey {
  id: string;
  name: string;
  column: string;
  referencedTable: string;
  referencedColumn: string;
  onDelete: 'CASCADE' | 'SET NULL' | 'NO ACTION' | 'RESTRICT';
  onUpdate: 'CASCADE' | 'SET NULL' | 'NO ACTION' | 'RESTRICT';
}

interface TableConstraint {
  id: string;
  name: string;
  type: 'CHECK' | 'UNIQUE' | 'DEFAULT';
  expression: string;
  columns?: string[];
}

interface Table {
  id: string;
  name: string;
  x: number;
  y: number;
  columns: Column[];
  schema?: string;
  tableType?: 'Disk Based' | 'Memory Optimized' | 'File Table';
  description?: string;
  filegroup?: string;
  lockEscalation?: 'AUTO' | 'TABLE' | 'DISABLE';
  indexes?: TableIndex[];
  foreignKeys?: ForeignKey[];
  constraints?: TableConstraint[];
  businessTerms?: string[];
  triggers?: string[];
  comments?: string;
}

interface Column {
  id: string;
  name: string;
  dataType: string;
  isPK: boolean;
  isNullable: boolean;
  defaultValue?: string;
  isFK?: boolean;
  description?: string;
  // SQL Server specific properties
  isRowGuid?: boolean;
  isSparse?: boolean;
  isHidden?: boolean;
  collation?: string;
  averageWidth?: number;
  percentNull?: number;
  isPersisted?: boolean;
  columnMaskFunction?: string;
  encryptionType?: string;
}

interface Relationship {
  id: string;
  fromTable: string;
  toTable: string;
  type: '1:1' | '1:N' | 'N:M';
}

// Mock data
const mockTables: Table[] = [
  {
    id: 'table-1',
    name: 'Users',
    x: 100,
    y: 100,
    columns: [
      { id: 'col-1', name: 'user_id', dataType: 'INTEGER', isPK: true, isNullable: false },
      { id: 'col-2', name: 'username', dataType: 'VARCHAR(50)', isPK: false, isNullable: false },
      { id: 'col-3', name: 'email', dataType: 'VARCHAR(100)', isPK: false, isNullable: false },
      { id: 'col-4', name: 'created_at', dataType: 'TIMESTAMP', isPK: false, isNullable: true }
    ]
  },
  {
    id: 'table-2',
    name: 'Orders',
    x: 400,
    y: 100,
    columns: [
      { id: 'col-5', name: 'order_id', dataType: 'INTEGER', isPK: true, isNullable: false },
      { id: 'col-6', name: 'user_id', dataType: 'INTEGER', isPK: false, isNullable: false },
      { id: 'col-7', name: 'total_amount', dataType: 'DECIMAL(10,2)', isPK: false, isNullable: false },
      { id: 'col-8', name: 'order_date', dataType: 'TIMESTAMP', isPK: false, isNullable: false }
    ]
  }
];

const mockRelationships: Relationship[] = [
  { id: 'rel-1', fromTable: 'table-1', toTable: 'table-2', type: '1:N' }
];

export default function Diagrammer() {
  const [viewMode, setViewMode] = useState<ViewMode>('diagram');
  const [activeTool, setActiveTool] = useState<Tool>('select');
  const [isLocked, setIsLocked] = useState(false);
  const [zoom, setZoom] = useState(100);
  const [tables, setTables] = useState<Table[]>(mockTables);
  const [relationships] = useState<Relationship[]>(mockRelationships);
  const [selectedTable, setSelectedTable] = useState<string | null>(null);
  const [showLeftPanel, setShowLeftPanel] = useState(true);
  const [showPropertiesPanel, setShowPropertiesPanel] = useState(true);
  const [isDark, setIsDark] = useState(true);
  const [showGrid, setShowGrid] = useState(true);
  const [snapToGrid, setSnapToGrid] = useState(false);
  const [showMinimap, setShowMinimap] = useState(false);
  const [isPanMode, setIsPanMode] = useState(false);

  const handleZoomIn = () => setZoom(prev => Math.min(prev + 10, 200));
  const handleZoomOut = () => setZoom(prev => Math.max(prev - 10, 50));
  const handleResetZoom = () => setZoom(100);
  const handleFitToScreen = () => {
    // Calculate bounds of all tables and fit zoom to show them all
    if (tables.length === 0) return;
    // For now, just reset to 100%
    setZoom(100);
  };
  const handleAutoLayout = () => {
    // Auto-arrange tables in a grid layout
    const gridCols = Math.ceil(Math.sqrt(tables.length));
    const spacing = 300;
    const layoutTables = tables.map((table, index) => ({
      ...table,
      x: (index % gridCols) * spacing + 100,
      y: Math.floor(index / gridCols) * spacing + 100
    }));
    setTables(layoutTables);
  };

  const handleAddTable = () => {
    const newTable: Table = {
      id: `table-${Date.now()}`,
      name: 'NewTable',
      x: 200,
      y: 200,
      columns: [
        { id: `col-${Date.now()}`, name: 'id', dataType: 'INTEGER', isPK: true, isNullable: false }
      ]
    };
    setTables([...tables, newTable]);
  };

  return (
    <div className={`h-full flex flex-col ${isDark ? 'bg-zinc-950' : 'bg-gray-50'}`}>
      {/* Top Toolbar */}
      <div className={`flex items-center justify-between px-4 py-2 border-b ${isDark ? 'border-zinc-800 bg-zinc-900' : 'border-gray-200 bg-white'}`}>
        <div className="flex items-center gap-4">
          {/* View Mode Tabs */}
          <div className={`flex items-center gap-1 rounded-lg p-0.5 ${isDark ? 'bg-zinc-800' : 'bg-gray-100'}`}>
            <button
              onClick={() => setViewMode('diagram')}
              className={`px-3 py-1.5 rounded-md text-xs font-medium transition-colors ${
                viewMode === 'diagram'
                  ? isDark ? 'bg-zinc-700 text-gray-100 shadow-sm' : 'bg-white text-gray-900 shadow-sm'
                  : isDark ? 'text-gray-400 hover:text-gray-100' : 'text-gray-600 hover:text-gray-900'
              }`}
            >
              <Eye className="w-3.5 h-3.5 inline mr-1.5" />
              Diagram View
            </button>
            <button
              onClick={() => setViewMode('quick-editor')}
              className={`px-3 py-1.5 rounded-md text-xs font-medium transition-colors ${
                viewMode === 'quick-editor'
                  ? isDark ? 'bg-zinc-700 text-gray-100 shadow-sm' : 'bg-white text-gray-900 shadow-sm'
                  : isDark ? 'text-gray-400 hover:text-gray-100' : 'text-gray-600 hover:text-gray-900'
              }`}
            >
              <Table2 className="w-3.5 h-3.5 inline mr-1.5" />
              Quick Editor
            </button>
            <button
              onClick={() => setViewMode('properties')}
              className={`px-3 py-1.5 rounded-md text-xs font-medium transition-colors ${
                viewMode === 'properties'
                  ? isDark ? 'bg-zinc-700 text-gray-100 shadow-sm' : 'bg-white text-gray-900 shadow-sm'
                  : isDark ? 'text-gray-400 hover:text-gray-100' : 'text-gray-600 hover:text-gray-900'
              }`}
            >
              <Settings className="w-3.5 h-3.5 inline mr-1.5" />
              Properties
            </button>
          </div>

          <div className={`w-px h-6 ${isDark ? 'bg-zinc-700' : 'bg-gray-300'}`} />

          {/* Tools */}
          {viewMode === 'diagram' && (
            <div className="flex items-center gap-1">
              <button
                onClick={() => setActiveTool('select')}
                className={`p-1.5 rounded transition-colors ${
                  activeTool === 'select'
                    ? 'bg-indigo-500/20 text-indigo-400'
                    : isDark ? 'text-gray-400 hover:bg-zinc-800' : 'text-gray-600 hover:bg-gray-100'
                }`}
                title="Select"
              >
                <MousePointer2 className="w-4 h-4" />
              </button>
              <button
                onClick={() => setActiveTool('table')}
                className={`p-1.5 rounded transition-colors ${
                  activeTool === 'table'
                    ? 'bg-indigo-500/20 text-indigo-400'
                    : isDark ? 'text-gray-400 hover:bg-zinc-800' : 'text-gray-600 hover:bg-gray-100'
                }`}
                title="Add Table"
              >
                <Box className="w-4 h-4" />
              </button>
              <button
                onClick={() => setActiveTool('relationship')}
                className={`p-1.5 rounded transition-colors ${
                  activeTool === 'relationship'
                    ? 'bg-indigo-500/20 text-indigo-400'
                    : isDark ? 'text-gray-400 hover:bg-zinc-800' : 'text-gray-600 hover:bg-gray-100'
                }`}
                title="Add Relationship"
              >
                <Link2 className="w-4 h-4" />
              </button>
              <button
                onClick={() => setActiveTool('note')}
                className={`p-1.5 rounded transition-colors ${
                  activeTool === 'note'
                    ? 'bg-indigo-500/20 text-indigo-400'
                    : isDark ? 'text-gray-400 hover:bg-zinc-800' : 'text-gray-600 hover:bg-gray-100'
                }`}
                title="Add Note"
              >
                <FileText className="w-4 h-4" />
              </button>
            </div>
          )}
        </div>

        <div className="flex items-center gap-2">
          {/* Zoom Controls */}
          {viewMode === 'diagram' && (
            <>
              <div className={`flex items-center gap-1 rounded-lg px-2 py-1 ${isDark ? 'bg-zinc-800' : 'bg-gray-100'}`}>
                <button
                  onClick={handleZoomOut}
                  className={`p-1 rounded ${isDark ? 'hover:bg-zinc-700' : 'hover:bg-gray-200'}`}
                  title="Zoom Out"
                >
                  <ZoomOut className={`w-3.5 h-3.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`} />
                </button>
                <span className={`text-xs font-medium min-w-[3rem] text-center ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>{zoom}%</span>
                <button
                  onClick={handleZoomIn}
                  className={`p-1 rounded ${isDark ? 'hover:bg-zinc-700' : 'hover:bg-gray-200'}`}
                  title="Zoom In"
                >
                  <ZoomIn className={`w-3.5 h-3.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`} />
                </button>
              </div>
              <div className={`w-px h-6 ${isDark ? 'bg-zinc-700' : 'bg-gray-300'}`} />
            </>
          )}

          {/* Actions */}
          <button
            className={`p-1.5 rounded ${isDark ? 'text-gray-400 hover:bg-zinc-800' : 'text-gray-600 hover:bg-gray-100'}`}
            title="Undo"
          >
            <Undo2 className="w-4 h-4" />
          </button>
          <button
            className={`p-1.5 rounded ${isDark ? 'text-gray-400 hover:bg-zinc-800' : 'text-gray-600 hover:bg-gray-100'}`}
            title="Redo"
          >
            <Redo2 className="w-4 h-4" />
          </button>

          <div className={`w-px h-6 ${isDark ? 'bg-zinc-700' : 'bg-gray-300'}`} />

          <button
            onClick={() => setIsLocked(!isLocked)}
            className={`px-3 py-1.5 rounded-md text-xs font-medium flex items-center gap-1.5 transition-colors ${
              isLocked
                ? 'bg-red-500/20 text-red-400 hover:bg-red-500/30'
                : isDark ? 'bg-zinc-800 text-gray-400 hover:bg-zinc-700' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
            }`}
          >
            {isLocked ? <Lock className="w-3.5 h-3.5" /> : <Unlock className="w-3.5 h-3.5" />}
            {isLocked ? 'Locked' : 'Unlocked'}
          </button>

          {/* Theme Toggle Button */}
          <button
            onClick={() => setIsDark(!isDark)}
            className={`p-1.5 rounded-lg transition-colors ${
              isDark ? 'text-gray-400 hover:bg-zinc-800' : 'text-gray-600 hover:bg-gray-100'
            }`}
            title={isDark ? 'Switch to Light Mode' : 'Switch to Dark Mode'}
          >
            {isDark ? <Sun className="w-4 h-4" /> : <Moon className="w-4 h-4" />}
          </button>

          <button className="px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-md text-xs font-medium flex items-center gap-1.5 transition-colors">
            <Save className="w-3.5 h-3.5" />
            Save
          </button>
        </div>
      </div>

      {/* Main Content Area */}
      <div className="flex-1 flex overflow-hidden">
        {/* Left Panel */}
        <AnimatePresence>
          {showLeftPanel && viewMode !== 'properties' && (
            <motion.div
              initial={{ width: 0, opacity: 0 }}
              animate={{ width: 240, opacity: 1 }}
              exit={{ width: 0, opacity: 0 }}
              className={`border-r overflow-auto ${
                isDark ? 'border-zinc-800 bg-zinc-900' : 'border-gray-200 bg-white'
              }`}
            >
              <LeftPanel isDark={isDark} />
            </motion.div>
          )}
        </AnimatePresence>

        {/* Center Canvas */}
        <div className="flex-1 flex flex-col overflow-hidden">
          <AnimatePresence mode="wait">
            {viewMode === 'diagram' && (
              <DiagramView
                tables={tables}
                relationships={relationships}
                zoom={zoom}
                selectedTable={selectedTable}
                onTableSelect={setSelectedTable}
                onAddTable={handleAddTable}
                onTablesUpdate={setTables}
                isDark={isDark}
                showGrid={showGrid}
                snapToGrid={snapToGrid}
                isPanMode={isPanMode}
                onZoomIn={handleZoomIn}
                onZoomOut={handleZoomOut}
                onFitToScreen={handleFitToScreen}
                onAutoLayout={handleAutoLayout}
                onToggleGrid={() => setShowGrid(!showGrid)}
                onToggleSnap={() => setSnapToGrid(!snapToGrid)}
                onToggleMinimap={() => setShowMinimap(!showMinimap)}
                onTogglePan={() => setIsPanMode(!isPanMode)}
                showMinimap={showMinimap}
              />
            )}
            {viewMode === 'quick-editor' && (
              <QuickEditor tables={tables} onTablesUpdate={setTables} isDark={isDark} />
            )}
            {viewMode === 'properties' && (
              <PropertiesView selectedTable={tables.find(t => t.id === selectedTable)} isDark={isDark} />
            )}
          </AnimatePresence>
        </div>

        {/* Right Properties Panel */}
        <AnimatePresence>
          {showPropertiesPanel && viewMode === 'diagram' && (
            <motion.div
              initial={{ width: 0, opacity: 0 }}
              animate={{ width: 240, opacity: 1 }}
              exit={{ width: 0, opacity: 0 }}
              className={`border-l overflow-auto ${
                isDark ? 'border-zinc-800 bg-zinc-900' : 'border-gray-200 bg-white'
              }`}
            >
              <RightPropertiesPanel table={tables.find(t => t.id === selectedTable)} isDark={isDark} />
            </motion.div>
          )}
        </AnimatePresence>
      </div>
    </div>
  );
}

// Toolbar Button Component
const ToolbarButton = ({
  icon: Icon,
  tooltip,
  isDark,
  isActive = false,
  onClick
}: {
  icon: any;
  tooltip: string;
  isDark: boolean;
  isActive?: boolean;
  onClick?: () => void;
}) => {
  const [showTooltip, setShowTooltip] = useState(false);

  return (
    <div className="relative">
      <button
        className={`p-2.5 rounded-lg hover:scale-105 transition-all duration-200 cursor-pointer ${
          isActive
            ? isDark
              ? 'bg-indigo-600 text-white shadow-md'
              : 'bg-indigo-500 text-white shadow-md'
            : isDark
            ? 'hover:bg-zinc-700 text-gray-300'
            : 'hover:bg-gray-100 text-gray-600'
        }`}
        onMouseEnter={() => setShowTooltip(true)}
        onMouseLeave={() => setShowTooltip(false)}
        onClick={onClick}
        style={{ pointerEvents: 'auto', zIndex: 10000 }}
      >
        <Icon className="w-4 h-4" />
      </button>
      {showTooltip && (
        <div className={`absolute left-full ml-2 top-1/2 -translate-y-1/2 px-2 py-1 rounded-lg text-xs whitespace-nowrap z-50 ${
          isDark ? 'bg-zinc-700 text-white' : 'bg-gray-800 text-white'
        }`}>
          {tooltip}
        </div>
      )}
    </div>
  );
};

// Shape Dropdown Component
const ShapeDropdown = ({ isDark }: { isDark: boolean }) => {
  const [isOpen, setIsOpen] = useState(false);
  const [showTooltip, setShowTooltip] = useState(false);

  return (
    <div className="relative">
      <button
        className={`p-2.5 rounded-lg hover:scale-105 transition-all duration-200 cursor-pointer ${
          isDark ? 'hover:bg-zinc-700 text-gray-300' : 'hover:bg-gray-100 text-gray-600'
        }`}
        onMouseEnter={() => !isOpen && setShowTooltip(true)}
        onMouseLeave={() => setShowTooltip(false)}
        onClick={() => {
          setIsOpen(!isOpen);
          setShowTooltip(false);
        }}
        style={{ pointerEvents: 'auto', zIndex: 10000 }}
      >
        <Shapes className="w-4 h-4" />
      </button>
      {showTooltip && !isOpen && (
        <div className={`absolute left-full ml-2 top-1/2 -translate-y-1/2 px-2 py-1 rounded-lg text-xs whitespace-nowrap z-50 ${
          isDark ? 'bg-zinc-700 text-white' : 'bg-gray-800 text-white'
        }`}>
          Shapes
        </div>
      )}
      {isOpen && (
        <div className={`absolute left-full ml-2 top-0 rounded-lg shadow-lg border p-1.5 flex flex-col gap-1 ${
          isDark ? 'bg-zinc-800 border-zinc-700' : 'bg-white border-gray-200'
        }`} style={{ zIndex: 10001 }}>
          <button
            className={`p-2 rounded-lg hover:scale-105 transition-all duration-200 cursor-pointer flex items-center gap-2 ${
              isDark ? 'hover:bg-zinc-700 text-gray-300' : 'hover:bg-gray-100 text-gray-600'
            }`}
            onClick={() => setIsOpen(false)}
          >
            <Square className="w-4 h-4" />
            <span className="text-xs whitespace-nowrap">Rectangle</span>
          </button>
          <button
            className={`p-2 rounded-lg hover:scale-105 transition-all duration-200 cursor-pointer flex items-center gap-2 ${
              isDark ? 'hover:bg-zinc-700 text-gray-300' : 'hover:bg-gray-100 text-gray-600'
            }`}
            onClick={() => setIsOpen(false)}
          >
            <Circle className="w-4 h-4" />
            <span className="text-xs whitespace-nowrap">Ellipse</span>
          </button>
          <button
            className={`p-2 rounded-lg hover:scale-105 transition-all duration-200 cursor-pointer flex items-center gap-2 ${
              isDark ? 'hover:bg-zinc-700 text-gray-300' : 'hover:bg-gray-100 text-gray-600'
            }`}
            onClick={() => setIsOpen(false)}
          >
            <ArrowRight className="w-4 h-4" />
            <span className="text-xs whitespace-nowrap">Line</span>
          </button>
        </div>
      )}
    </div>
  );
};

// Object Toolbar Component
const ObjectToolbar = ({
  isDark,
  isDrawingMode,
  onSelectTool
}: {
  isDark: boolean;
  isDrawingMode: 'table' | 'annotation' | 'relationship' | null;
  onSelectTool: (mode: 'table' | 'annotation' | 'relationship' | null) => void;
}) => {
  return (
    <div className={`absolute top-6 left-6 flex flex-col gap-1 p-1.5 rounded-xl shadow-lg backdrop-blur-sm border z-50 ${
      isDark ? 'bg-zinc-800/90 border-zinc-700' : 'bg-white/90 border-gray-200'
    }`} style={{ fontFamily: 'Inter, system-ui, sans-serif', zIndex: 9999, pointerEvents: 'auto' }}>
      <ToolbarButton
        icon={MousePointer}
        tooltip="Pointer/Select Tool"
        isDark={isDark}
        isActive={isDrawingMode === null}
        onClick={() => onSelectTool(null)}
      />
      <ToolbarButton
        icon={Database}
        tooltip="Add Entity/Table"
        isDark={isDark}
        isActive={isDrawingMode === 'table'}
        onClick={() => onSelectTool('table')}
      />
      <ToolbarButton
        icon={GitBranch}
        tooltip="Add Relationship"
        isDark={isDark}
        isActive={isDrawingMode === 'relationship'}
        onClick={() => onSelectTool('relationship')}
      />
      <ToolbarButton
        icon={StickyNote}
        tooltip="Add Note/Annotation"
        isDark={isDark}
        isActive={isDrawingMode === 'annotation'}
        onClick={() => onSelectTool('annotation')}
      />
      <div className={`h-px w-6 my-1 ${isDark ? 'bg-zinc-700' : 'bg-gray-300'}`} />
      <ToolbarButton icon={Group} tooltip="Group Entities" isDark={isDark} />
      <ToolbarButton icon={Ungroup} tooltip="Ungroup Entities" isDark={isDark} />
      <div className={`h-px w-6 my-1 ${isDark ? 'bg-zinc-700' : 'bg-gray-300'}`} />
      <ShapeDropdown isDark={isDark} />
    </div>
  );
};

// View Toolbar Button Component
const ViewToolbarButton = ({
  icon: Icon,
  tooltip,
  isDark,
  onClick,
  isActive = false
}: {
  icon: any;
  tooltip: string;
  isDark: boolean;
  onClick?: () => void;
  isActive?: boolean
}) => {
  const [showTooltip, setShowTooltip] = useState(false);

  return (
    <div className="relative">
      <button
        className={`p-2.5 rounded-lg hover:scale-105 transition-all duration-200 ${
          isActive
            ? isDark ? 'bg-indigo-600 text-white' : 'bg-indigo-500 text-white'
            : isDark ? 'hover:bg-zinc-700 text-gray-300' : 'hover:bg-gray-100 text-gray-600'
        }`}
        onMouseEnter={() => setShowTooltip(true)}
        onMouseLeave={() => setShowTooltip(false)}
        onClick={onClick}
      >
        <Icon className="w-4 h-4" />
      </button>
      {showTooltip && (
        <div className={`absolute bottom-full mb-2 left-1/2 -translate-x-1/2 px-2 py-1 rounded-lg text-xs whitespace-nowrap z-50 ${
          isDark ? 'bg-zinc-700 text-white' : 'bg-gray-800 text-white'
        }`}>
          {tooltip}
        </div>
      )}
    </div>
  );
};

// View Controls Toolbar Component
const ViewControlsToolbar = ({
  isDark,
  onZoomIn,
  onZoomOut,
  onFitToScreen,
  onAutoLayout,
  zoomLevel,
  showGrid,
  onToggleGrid,
  snapToGrid,
  onToggleSnap,
  showMinimap,
  onToggleMinimap,
  isPanMode,
  onTogglePan
}: {
  isDark: boolean;
  onZoomIn: () => void;
  onZoomOut: () => void;
  onFitToScreen: () => void;
  onAutoLayout: () => void;
  zoomLevel: number;
  showGrid: boolean;
  onToggleGrid: () => void;
  snapToGrid: boolean;
  onToggleSnap: () => void;
  showMinimap: boolean;
  onToggleMinimap: () => void;
  isPanMode: boolean;
  onTogglePan: () => void;
}) => {
  return (
    <div className={`absolute bottom-6 left-1/2 transform -translate-x-1/2 flex items-center gap-1 p-1.5 rounded-xl shadow-lg backdrop-blur-sm border z-50 ${
      isDark ? 'bg-zinc-800/95 border-zinc-700' : 'bg-white/95 border-gray-200'
    }`} style={{ fontFamily: 'Inter, system-ui, sans-serif' }}>
      <ViewToolbarButton icon={ZoomIn} tooltip={`Zoom In (${zoomLevel}%)`} isDark={isDark} onClick={onZoomIn} />
      <ViewToolbarButton icon={ZoomOut} tooltip={`Zoom Out (${zoomLevel}%)`} isDark={isDark} onClick={onZoomOut} />
      <ViewToolbarButton icon={Maximize2} tooltip="Fit to Screen" isDark={isDark} onClick={onFitToScreen} />
      <div className={`w-px h-6 mx-1 ${isDark ? 'bg-zinc-700' : 'bg-gray-300'}`} />
      <ViewToolbarButton icon={Hand} tooltip="Pan/Hand Tool" isDark={isDark} onClick={onTogglePan} isActive={isPanMode} />
      <div className={`w-px h-6 mx-1 ${isDark ? 'bg-zinc-700' : 'bg-gray-300'}`} />
      <ViewToolbarButton icon={Grid} tooltip="Toggle Grid" isDark={isDark} onClick={onToggleGrid} isActive={showGrid} />
      <ViewToolbarButton icon={Target} tooltip="Snap to Grid/Alignment" isDark={isDark} onClick={onToggleSnap} isActive={snapToGrid} />
      <div className={`w-px h-6 mx-1 ${isDark ? 'bg-zinc-700' : 'bg-gray-300'}`} />
      <ViewToolbarButton icon={Sparkles} tooltip="Auto-layout" isDark={isDark} onClick={onAutoLayout} />
      <ViewToolbarButton icon={Map} tooltip="Toggle Minimap" isDark={isDark} onClick={onToggleMinimap} isActive={showMinimap} />
    </div>
  );
};

// Left Panel Component with Model Explorer Tree
function LeftPanel({ isDark }: { isDark: boolean }) {
  const [expandedItems, setExpandedItems] = useState<Set<string>>(new Set(['model-root', 'entities-tables', 'relationships']));
  const [searchTerm, setSearchTerm] = useState('');

  const toggleExpanded = (id: string) => {
    const newExpanded = new Set(expandedItems);
    if (newExpanded.has(id)) {
      newExpanded.delete(id);
    } else {
      newExpanded.add(id);
    }
    setExpandedItems(newExpanded);
  };

  const treeData = [
    {
      id: 'model-root',
      label: 'E-Commerce Platform',
      icon: <Database className="w-4 h-4 text-blue-500" />,
      type: 'model',
      children: [
        {
          id: 'model-properties',
          label: 'Model Properties',
          icon: <Settings className="w-4 h-4 text-gray-500" />,
          type: 'folder'
        },
        {
          id: 'subject-areas',
          label: 'Subject Areas',
          icon: <Component className="w-4 h-4 text-purple-500" />,
          type: 'folder',
          children: [
            {
              id: 'sa-customer-mgmt',
              label: 'Customer Management',
              icon: <Box className="w-4 h-4 text-purple-400" />,
              type: 'subject-area'
            },
            {
              id: 'sa-order-processing',
              label: 'Order Processing',
              icon: <Box className="w-4 h-4 text-purple-400" />,
              type: 'subject-area'
            }
          ]
        },
        {
          id: 'diagrams-root',
          label: 'Diagrams',
          icon: <Workflow className="w-4 h-4 text-blue-500" />,
          type: 'folder',
          children: [
            {
              id: 'logical-diagrams',
              label: 'Logical Diagram(s)',
              icon: <FileText className="w-4 h-4 text-green-500" />,
              type: 'folder',
              children: [
                {
                  id: 'diagram-logical-main',
                  label: 'Main Logical Model',
                  icon: <FileText className="w-4 h-4 text-green-400" />,
                  type: 'diagram'
                }
              ]
            },
            {
              id: 'physical-diagrams',
              label: 'Physical Diagram(s)',
              icon: <FileText className="w-4 h-4 text-orange-500" />,
              type: 'folder',
              children: [
                {
                  id: 'diagram-physical-main',
                  label: 'Main Physical Model',
                  icon: <FileText className="w-4 h-4 text-orange-400" />,
                  type: 'diagram'
                }
              ]
            }
          ]
        },
        {
          id: 'domains',
          label: 'Domains',
          icon: <Type className="w-4 h-4 text-blue-500" />,
          type: 'folder',
          children: [
            {
              id: 'domain-email',
              label: 'EmailAddress',
              icon: <Type className="w-4 h-4 text-blue-400" />,
              type: 'domain'
            },
            {
              id: 'domain-currency',
              label: 'Currency',
              icon: <Type className="w-4 h-4 text-blue-400" />,
              type: 'domain'
            }
          ]
        },
        {
          id: 'entities-tables',
          label: 'Tables',
          icon: <Database className="w-4 h-4 text-purple-500" />,
          type: 'folder',
          children: [
            {
              id: 'entity-customer',
              label: 'Customer',
              icon: <Box className="w-4 h-4 text-purple-500" />,
              type: 'entity',
              children: [
                {
                  id: 'customer-attributes',
                  label: 'Columns',
                  icon: <Hash className="w-4 h-4 text-gray-500" />,
                  type: 'folder',
                  children: [
                    {
                      id: 'customer-pk',
                      label: 'Primary Keys (PK)',
                      icon: <Key className="w-4 h-4 text-yellow-500" />,
                      type: 'folder',
                      children: [
                        {
                          id: 'attr-customer-id',
                          label: 'customer_id',
                          icon: <Key className="w-3.5 h-3.5 text-yellow-500" />,
                          type: 'attribute'
                        }
                      ]
                    },
                    {
                      id: 'customer-other',
                      label: 'Other attributes',
                      icon: <Hash className="w-4 h-4 text-gray-500" />,
                      type: 'folder',
                      children: [
                        {
                          id: 'attr-first-name',
                          label: 'first_name',
                          icon: <Hash className="w-3.5 h-3.5 text-gray-500" />,
                          type: 'attribute'
                        },
                        {
                          id: 'attr-email',
                          label: 'email',
                          icon: <Hash className="w-3.5 h-3.5 text-gray-500" />,
                          type: 'attribute'
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              id: 'entity-order',
              label: 'Order',
              icon: <Box className="w-4 h-4 text-purple-500" />,
              type: 'entity',
              children: [
                {
                  id: 'order-attributes',
                  label: 'Columns',
                  icon: <Hash className="w-4 h-4 text-gray-500" />,
                  type: 'folder',
                  children: [
                    {
                      id: 'order-pk',
                      label: 'Primary Keys (PK)',
                      icon: <Key className="w-4 h-4 text-yellow-500" />,
                      type: 'folder',
                      children: [
                        {
                          id: 'attr-order-id',
                          label: 'order_id',
                          icon: <Key className="w-3.5 h-3.5 text-yellow-500" />,
                          type: 'attribute'
                        }
                      ]
                    },
                    {
                      id: 'order-fk',
                      label: 'Foreign Keys (FK)',
                      icon: <LinkIcon className="w-4 h-4 text-blue-500" />,
                      type: 'folder',
                      children: [
                        {
                          id: 'attr-customer-fk',
                          label: 'customer_id',
                          icon: <LinkIcon className="w-3.5 h-3.5 text-blue-500" />,
                          type: 'attribute'
                        }
                      ]
                    },
                    {
                      id: 'order-other',
                      label: 'Other attributes',
                      icon: <Hash className="w-4 h-4 text-gray-500" />,
                      type: 'folder',
                      children: [
                        {
                          id: 'attr-order-date',
                          label: 'order_date',
                          icon: <Hash className="w-3.5 h-3.5 text-gray-500" />,
                          type: 'attribute'
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          id: 'relationships',
          label: 'Relationships',
          icon: <GitBranch className="w-4 h-4 text-green-500" />,
          type: 'folder',
          children: [
            {
              id: 'identifying-rel',
              label: 'Identifying',
              icon: <GitBranch className="w-4 h-4 text-green-600" />,
              type: 'folder',
              children: [
                {
                  id: 'rel-customer-order',
                  label: 'Customer_Order',
                  icon: <GitBranch className="w-4 h-4 text-green-500" />,
                  type: 'relationship'
                }
              ]
            },
            {
              id: 'non-identifying-rel',
              label: 'Non-identifying',
              icon: <GitMerge className="w-4 h-4 text-green-600" />,
              type: 'folder',
              children: [
                {
                  id: 'rel-order-product',
                  label: 'Order_Product',
                  icon: <GitMerge className="w-4 h-4 text-green-500" />,
                  type: 'relationship'
                }
              ]
            },
            {
              id: 'many-to-many-rel',
              label: 'Many-to-Many',
              icon: <Network className="w-4 h-4 text-green-600" />,
              type: 'folder',
              children: [
                {
                  id: 'rel-product-category',
                  label: 'Product_Category',
                  icon: <Network className="w-4 h-4 text-green-500" />,
                  type: 'relationship'
                }
              ]
            }
          ]
        },
        {
          id: 'views',
          label: 'Views',
          icon: <Eye className="w-4 h-4 text-cyan-500" />,
          type: 'folder',
          children: [
            {
              id: 'logical-views',
              label: 'Logical views',
              icon: <Eye className="w-4 h-4 text-cyan-600" />,
              type: 'folder',
              children: [
                {
                  id: 'view-customer-summary',
                  label: 'CustomerSummary',
                  icon: <Eye className="w-4 h-4 text-cyan-500" />,
                  type: 'view'
                }
              ]
            },
            {
              id: 'physical-views',
              label: 'Physical views (SQL)',
              icon: <FileCode className="w-4 h-4 text-cyan-600" />,
              type: 'folder',
              children: [
                {
                  id: 'view-customer-orders',
                  label: 'VW_CUSTOMER_ORDERS',
                  icon: <FileCode className="w-4 h-4 text-cyan-500" />,
                  type: 'view'
                }
              ]
            }
          ]
        },
        {
          id: 'sequences-procedures-triggers',
          label: 'Sequences / Procedures / Triggers',
          icon: <Zap className="w-4 h-4 text-red-500" />,
          type: 'folder',
          children: [
            {
              id: 'sequences',
              label: 'Sequences',
              icon: <Hash className="w-4 h-4 text-purple-600" />,
              type: 'folder',
              children: [
                {
                  id: 'seq-customer-id',
                  label: 'SEQ_CUSTOMER_ID',
                  icon: <Hash className="w-4 h-4 text-purple-500" />,
                  type: 'sequence'
                }
              ]
            },
            {
              id: 'stored-procedures',
              label: 'Stored Procedures',
              icon: <Command className="w-4 h-4 text-red-600" />,
              type: 'folder',
              children: [
                {
                  id: 'proc-get-orders',
                  label: 'SP_GET_CUSTOMER_ORDERS',
                  icon: <Command className="w-4 h-4 text-red-500" />,
                  type: 'procedure'
                }
              ]
            },
            {
              id: 'triggers',
              label: 'Triggers',
              icon: <Zap className="w-4 h-4 text-yellow-600" />,
              type: 'folder',
              children: [
                {
                  id: 'trigger-audit',
                  label: 'TRG_CUSTOMER_AUDIT',
                  icon: <Zap className="w-4 h-4 text-yellow-500" />,
                  type: 'trigger'
                }
              ]
            }
          ]
        },
        {
          id: 'users-roles',
          label: 'Users / Roles',
          icon: <Users className="w-4 h-4 text-indigo-500" />,
          type: 'folder',
          children: [
            {
              id: 'users',
              label: 'Users',
              icon: <User className="w-4 h-4 text-indigo-600" />,
              type: 'folder',
              children: [
                {
                  id: 'user-admin',
                  label: 'db_admin',
                  icon: <Crown className="w-4 h-4 text-indigo-500" />,
                  type: 'user'
                }
              ]
            },
            {
              id: 'roles',
              label: 'Roles',
              icon: <UserPlus className="w-4 h-4 text-indigo-600" />,
              type: 'folder',
              children: [
                {
                  id: 'role-admin',
                  label: 'ADMIN_ROLE',
                  icon: <Crown className="w-4 h-4 text-indigo-500" />,
                  type: 'role'
                }
              ]
            },
            {
              id: 'permissions',
              label: 'Permissions',
              icon: <KeyRound className="w-4 h-4 text-indigo-600" />,
              type: 'folder',
              children: [
                {
                  id: 'perm-select',
                  label: 'SELECT_PERMISSION',
                  icon: <Eye className="w-4 h-4 text-indigo-500" />,
                  type: 'permission'
                }
              ]
            }
          ]
        },
        {
          id: 'other-objects',
          label: 'Other Objects (depending on DBMS)',
          icon: <Server className="w-4 h-4 text-gray-500" />,
          type: 'folder',
          children: [
            {
              id: 'indexes',
              label: 'Indexes',
              icon: <Search className="w-4 h-4 text-yellow-600" />,
              type: 'folder',
              children: [
                {
                  id: 'idx-customer-email',
                  label: 'IDX_CUSTOMER_EMAIL',
                  icon: <Search className="w-4 h-4 text-yellow-500" />,
                  type: 'index'
                }
              ]
            },
            {
              id: 'constraints',
              label: 'Constraints',
              icon: <Lock className="w-4 h-4 text-red-600" />,
              type: 'folder',
              children: [
                {
                  id: 'chk-email-format',
                  label: 'CHK_EMAIL_FORMAT',
                  icon: <Lock className="w-4 h-4 text-red-500" />,
                  type: 'constraint'
                }
              ]
            },
            {
              id: 'synonyms',
              label: 'Synonyms',
              icon: <Link2 className="w-4 h-4 text-purple-600" />,
              type: 'folder',
              children: [
                {
                  id: 'syn-customer',
                  label: 'SYN_CUSTOMER',
                  icon: <Link2 className="w-4 h-4 text-purple-500" />,
                  type: 'synonym'
                }
              ]
            },
            {
              id: 'schemas',
              label: 'Schemas',
              icon: <Folder className="w-4 h-4 text-blue-600" />,
              type: 'folder',
              children: [
                {
                  id: 'schema-public',
                  label: 'PUBLIC',
                  icon: <Globe className="w-4 h-4 text-blue-500" />,
                  type: 'schema'
                },
                {
                  id: 'schema-app',
                  label: 'APP_SCHEMA',
                  icon: <Folder className="w-4 h-4 text-blue-500" />,
                  type: 'schema'
                }
              ]
            },
            {
              id: 'tablespaces-storage',
              label: 'Tablespaces / Storage',
              icon: <Server className="w-4 h-4 text-gray-600" />,
              type: 'folder',
              children: [
                {
                  id: 'ts-data',
                  label: 'DATA_TABLESPACE',
                  icon: <Server className="w-4 h-4 text-gray-500" />,
                  type: 'tablespace'
                },
                {
                  id: 'ts-index',
                  label: 'INDEX_TABLESPACE',
                  icon: <Archive className="w-4 h-4 text-gray-500" />,
                  type: 'tablespace'
                }
              ]
            }
          ]
        }
      ]
    }
  ];

  const TreeItem = ({
    id,
    label,
    icon,
    children,
    level = 0
  }: {
    id: string;
    label: string;
    icon: React.ReactNode;
    children?: any[];
    level?: number;
  }) => {
    const isExpanded = expandedItems.has(id);
    const hasChildren = children && children.length > 0;

    return (
      <div>
        <div
          className={`group flex items-center gap-2 px-2 py-1.5 text-sm rounded-md cursor-pointer transition-all duration-200 ${
            isDark
              ? 'text-gray-300 hover:text-gray-100 hover:bg-zinc-800/70'
              : 'text-gray-700 hover:text-gray-900 hover:bg-gray-100'
          }`}
          style={{ paddingLeft: `${8 + level * 16}px` }}
          onClick={() => hasChildren && toggleExpanded(id)}
        >
          {hasChildren ? (
            isExpanded ? (
              <ChevronDown className="w-3.5 h-3.5 flex-shrink-0" />
            ) : (
              <ChevronRight className="w-3.5 h-3.5 flex-shrink-0" />
            )
          ) : (
            <div className="w-3.5 h-3.5 flex-shrink-0" />
          )}
          <div className="flex-shrink-0">{icon}</div>
          <span className="flex-1 truncate">{label}</span>
        </div>
        {hasChildren && isExpanded && (
          <div>
            {children.map((child) => (
              <TreeItem key={child.id} {...child} level={level + 1} />
            ))}
          </div>
        )}
      </div>
    );
  };

  return (
    <div className="p-3">
      <h3 className={`text-xs font-semibold mb-3 ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>Model Tree</h3>

      {/* Search Box */}
      <div className="mb-3">
        <div className="relative">
          <Search className={`absolute left-2 top-1/2 transform -translate-y-1/2 w-3.5 h-3.5 ${isDark ? 'text-gray-400' : 'text-gray-500'}`} />
          <input
            type="text"
            placeholder="Search..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            className={`w-full pl-8 pr-3 py-1.5 text-xs rounded-lg border transition-all duration-200 ${
              isDark
                ? 'bg-zinc-800 border-zinc-700 text-gray-100 placeholder-gray-500 focus:border-indigo-500'
                : 'bg-white border-gray-300 text-gray-900 placeholder-gray-400 focus:border-indigo-500'
            } focus:outline-none focus:ring-1 focus:ring-indigo-500/20`}
          />
        </div>
      </div>

      {/* Tree Items */}
      <div className="space-y-0.5">
        {treeData.map((item) => (
          <TreeItem key={item.id} {...item} />
        ))}
      </div>
    </div>
  );
}

// Diagram View Component
function DiagramView({
  tables,
  relationships,
  zoom,
  selectedTable,
  onTableSelect,
  onAddTable,
  onTablesUpdate,
  isDark,
  showGrid,
  snapToGrid,
  isPanMode,
  onZoomIn,
  onZoomOut,
  onFitToScreen,
  onAutoLayout,
  onToggleGrid,
  onToggleSnap,
  onToggleMinimap,
  onTogglePan,
  showMinimap
}: {
  tables: Table[];
  relationships: Relationship[];
  zoom: number;
  selectedTable: string | null;
  onTableSelect: (id: string | null) => void;
  onAddTable: () => void;
  onTablesUpdate: (tables: Table[]) => void;
  isDark: boolean;
  showGrid: boolean;
  snapToGrid: boolean;
  isPanMode: boolean;
  onZoomIn: () => void;
  onZoomOut: () => void;
  onFitToScreen: () => void;
  onAutoLayout: () => void;
  onToggleGrid: () => void;
  onToggleSnap: () => void;
  onToggleMinimap: () => void;
  onTogglePan: () => void;
  showMinimap: boolean;
}) {
  const [draggingTable, setDraggingTable] = useState<string | null>(null);
  const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });
  const [isDrawingMode, setIsDrawingMode] = useState<'table' | 'annotation' | 'relationship' | null>(null);

  const handleToolSelection = (mode: 'table' | 'annotation' | 'relationship' | null) => {
    setIsDrawingMode(mode);
    if (mode === 'table') {
      onAddTable();
      setIsDrawingMode(null); // Reset to select mode after adding
    }
  };

  const handleMouseDown = (e: React.MouseEvent, tableId: string, table: Table) => {
    e.stopPropagation();
    setDraggingTable(tableId);
    onTableSelect(tableId);

    // Calculate offset from mouse position to table position
    const rect = (e.currentTarget as HTMLElement).getBoundingClientRect();
    const parentRect = (e.currentTarget as HTMLElement).offsetParent?.getBoundingClientRect();

    if (parentRect) {
      setDragOffset({
        x: (e.clientX - parentRect.left) / (zoom / 100) - table.x,
        y: (e.clientY - parentRect.top) / (zoom / 100) - table.y
      });
    }
  };

  const handleMouseMove = (e: React.MouseEvent) => {
    if (!draggingTable) return;

    const container = e.currentTarget;
    const rect = container.getBoundingClientRect();

    // Calculate new position accounting for zoom
    let newX = (e.clientX - rect.left) / (zoom / 100) - dragOffset.x;
    let newY = (e.clientY - rect.top) / (zoom / 100) - dragOffset.y;

    // Snap to grid if enabled
    if (snapToGrid) {
      const gridSize = 20;
      newX = Math.round(newX / gridSize) * gridSize;
      newY = Math.round(newY / gridSize) * gridSize;
    }

    // Update table position
    const updatedTables = tables.map(table =>
      table.id === draggingTable
        ? { ...table, x: Math.max(0, newX), y: Math.max(0, newY) }
        : table
    );
    onTablesUpdate(updatedTables);
  };

  const handleMouseUp = () => {
    setDraggingTable(null);
  };

  return (
    <motion.div
      key="diagram"
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      exit={{ opacity: 0 }}
      className={`flex-1 overflow-auto relative ${isDark ? 'bg-zinc-950' : 'bg-gray-50'}`}
      style={{
        backgroundImage: showGrid
          ? isDark
            ? 'radial-gradient(circle, #3A3A3A 1px, transparent 1px)'
            : 'radial-gradient(circle, #D1D5DB 1px, transparent 1px)'
          : 'none',
        backgroundSize: '20px 20px',
        cursor: isPanMode ? 'grab' : 'default'
      }}
    >
      <div
        className="relative"
        style={{
          transform: `scale(${zoom / 100})`,
          transformOrigin: 'top left',
          width: `${(100 / zoom) * 100}%`,
          height: `${(100 / zoom) * 100}%`,
          minHeight: '100%',
          minWidth: '100%'
        }}
        onMouseMove={handleMouseMove}
        onMouseUp={handleMouseUp}
        onMouseLeave={handleMouseUp}
      >
        {/* Render Tables */}
        {tables.map(table => (
          <div
            key={table.id}
            onMouseDown={(e) => handleMouseDown(e, table.id, table)}
            className={`absolute rounded-lg shadow-sm border-2 transition-colors select-none ${
              draggingTable === table.id ? 'cursor-grabbing' : 'cursor-grab'
            } ${
              selectedTable === table.id
                ? 'border-indigo-500 shadow-lg'
                : isDark
                  ? 'border-zinc-700 hover:border-zinc-600 bg-zinc-800'
                  : 'border-gray-300 hover:border-gray-400 bg-white'
            }`}
            style={{
              left: `${table.x}px`,
              top: `${table.y}px`,
              minWidth: '200px'
            }}
          >
            {/* Table Header */}
            <div className={`px-3 py-2 border-b rounded-t-lg ${
              isDark
                ? 'bg-zinc-900 border-zinc-700'
                : 'bg-gray-50 border-gray-200'
            }`}>
              <div className="flex items-center gap-2">
                <Database className={`w-3.5 h-3.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`} />
                <span className={`text-xs font-semibold ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>
                  {table.name}
                </span>
              </div>
            </div>

            {/* Columns */}
            <div className="p-2">
              {table.columns.map(col => (
                <div
                  key={col.id}
                  className={`flex items-center gap-2 px-2 py-1 text-xs rounded ${
                    isDark ? 'hover:bg-zinc-700' : 'hover:bg-gray-100'
                  }`}
                >
                  {col.isPK && (
                    <span className="w-4 h-4 flex items-center justify-center bg-amber-500/20 text-amber-400 rounded text-xs font-bold">
                      PK
                    </span>
                  )}
                  <span className={`flex-1 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                    {col.name}
                  </span>
                  <span className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-400'}`}>
                    {col.dataType}
                  </span>
                </div>
              ))}
            </div>
          </div>
        ))}

        {/* Empty State */}
        {tables.length === 0 && (
          <div className="absolute inset-0 flex items-center justify-center">
            <div className="text-center">
              <Database className={`w-12 h-12 mx-auto mb-3 ${isDark ? 'text-gray-600' : 'text-gray-400'}`} />
              <h3 className={`text-sm font-medium mb-2 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                No Tables Yet
              </h3>
              <p className={`text-xs mb-4 ${isDark ? 'text-gray-500' : 'text-gray-400'}`}>
                Start by adding your first table to the diagram
              </p>
              <button
                onClick={onAddTable}
                className="px-4 py-2 bg-indigo-600 text-white rounded-md text-xs font-medium hover:bg-indigo-700 transition-colors inline-flex items-center gap-2"
              >
                <Plus className="w-3.5 h-3.5" />
                Add Table
              </button>
            </div>
          </div>
        )}
      </div>

      {/* Floating Toolbars */}
      <ObjectToolbar
        isDark={isDark}
        isDrawingMode={isDrawingMode}
        onSelectTool={handleToolSelection}
      />
      <ViewControlsToolbar
        isDark={isDark}
        onZoomIn={onZoomIn}
        onZoomOut={onZoomOut}
        onFitToScreen={onFitToScreen}
        onAutoLayout={onAutoLayout}
        zoomLevel={zoom}
        showGrid={showGrid}
        onToggleGrid={onToggleGrid}
        snapToGrid={snapToGrid}
        onToggleSnap={onToggleSnap}
        showMinimap={showMinimap}
        onToggleMinimap={onToggleMinimap}
        isPanMode={isPanMode}
        onTogglePan={onTogglePan}
      />

      {/* Minimap */}
      {showMinimap && (
        <div className={`absolute bottom-6 right-6 w-48 h-32 rounded-lg border overflow-hidden z-50 shadow-lg ${
          isDark ? 'bg-zinc-800/95 border-zinc-700' : 'bg-white/95 border-gray-200'
        }`}>
          <div className="w-full h-full relative" style={{
            backgroundImage: showGrid
              ? isDark
                ? 'radial-gradient(circle, #3A3A3A 1px, transparent 1px)'
                : 'radial-gradient(circle, #D1D5DB 1px, transparent 1px)'
              : 'none',
            backgroundSize: '4px 4px'
          }}>
            {tables.map(table => (
              <div
                key={table.id}
                className={`absolute rounded ${
                  selectedTable === table.id
                    ? 'bg-indigo-500'
                    : isDark ? 'bg-zinc-600' : 'bg-gray-400'
                }`}
                style={{
                  left: `${(table.x / 2000) * 100}%`,
                  top: `${(table.y / 2000) * 100}%`,
                  width: '8px',
                  height: '8px'
                }}
              />
            ))}
          </div>
        </div>
      )}
    </motion.div>
  );
}

// Quick Editor Component is now imported from QuickEditorNew.tsx
// Old implementation removed - see QuickEditorNew.tsx for the redesigned version
  const [newTableNames, setNewTableNames] = useState<string>('');
  const [selectedTableId, setSelectedTableId] = useState<string | null>(null);
  const [localTables, setLocalTables] = useState<Table[]>(tables);
  const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);

  // When external tables change, sync local state
  React.useEffect(() => {
    setLocalTables(tables);
  }, [tables]);

  const handleAddTables = () => {
    const tableNames = newTableNames
      .split('\n')
      .map(name => name.trim())
      .filter(name => name.length > 0);

    if (tableNames.length === 0) return;

    const newTables: Table[] = tableNames.map((name, index) => ({
      id: `table-${Date.now()}-${index}`,
      name: name,
      x: 100 + (index * 50),
      y: 100 + (index * 50),
      columns: [],
      schema: 'dbo',
      tableType: 'Disk Based',
      description: ''
    }));

    const updatedTables = [...localTables, ...newTables];
    setLocalTables(updatedTables);
    setHasUnsavedChanges(true);
    setNewTableNames('');

    // Auto-select first new table
    if (newTables.length > 0) {
      setSelectedTableId(newTables[0].id);
      setWorkflowStep('edit-details');
    }
  };

  const handleRemoveTable = (tableId: string) => {
    const updatedTables = localTables.filter(t => t.id !== tableId);
    setLocalTables(updatedTables);
    setHasUnsavedChanges(true);
    if (selectedTableId === tableId) {
      setSelectedTableId(updatedTables.length > 0 ? updatedTables[0].id : null);
    }
  };

  const addColumn = () => {
    if (!selectedTableId) return;

    const updatedTables = localTables.map(table => {
      if (table.id === selectedTableId) {
        return {
          ...table,
          columns: [
            ...table.columns,
            {
              id: `col-${Date.now()}`,
              name: 'new_column',
              dataType: 'VARCHAR(50)',
              isPK: false,
              isNullable: true,
              isFK: false,
              description: ''
            }
          ]
        };
      }
      return table;
    });
    setLocalTables(updatedTables);
    setHasUnsavedChanges(true);
  };

  const updateColumn = (columnId: string, field: string, value: any) => {
    if (!selectedTableId) return;

    const updatedTables = localTables.map(table => {
      if (table.id === selectedTableId) {
        return {
          ...table,
          columns: table.columns.map(col =>
            col.id === columnId ? { ...col, [field]: value } : col
          )
        };
      }
      return table;
    });
    setLocalTables(updatedTables);
    setHasUnsavedChanges(true);
  };

  const deleteColumn = (columnId: string) => {
    if (!selectedTableId) return;

    const updatedTables = localTables.map(table => {
      if (table.id === selectedTableId) {
        return {
          ...table,
          columns: table.columns.filter(col => col.id !== columnId)
        };
      }
      return table;
    });
    setLocalTables(updatedTables);
    setHasUnsavedChanges(true);
  };

  const updateTableProperty = (field: string, value: any) => {
    if (!selectedTableId) return;

    const updatedTables = localTables.map(table => {
      if (table.id === selectedTableId) {
        return { ...table, [field]: value };
      }
      return table;
    });
    setLocalTables(updatedTables);
    setHasUnsavedChanges(true);
  };

  const handleSave = () => {
    onTablesUpdate(localTables);
    setHasUnsavedChanges(false);
  };

  const handleCancel = () => {
    setLocalTables(tables);
    setHasUnsavedChanges(false);
  };

  const selectedTable = selectedTableId ? localTables.find(t => t.id === selectedTableId) : null;

  // SQL Server data types
  const sqlServerDataTypes = [
    'INT', 'BIGINT', 'SMALLINT', 'TINYINT', 'BIT',
    'DECIMAL', 'NUMERIC', 'MONEY', 'SMALLMONEY', 'FLOAT', 'REAL',
    'DATE', 'TIME', 'DATETIME', 'DATETIME2', 'SMALLDATETIME', 'DATETIMEOFFSET',
    'CHAR', 'VARCHAR', 'TEXT', 'NCHAR', 'NVARCHAR', 'NTEXT',
    'BINARY', 'VARBINARY', 'IMAGE',
    'UNIQUEIDENTIFIER', 'XML', 'JSON'
  ];

  return (
    <motion.div
      key="quick-editor"
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      exit={{ opacity: 0, y: -20 }}
      className="flex-1 bg-zinc-950 overflow-auto p-6"
    >
      <div className="max-w-7xl mx-auto">
        {/* Header */}
        <div className="flex items-center justify-between mb-6">
          <div>
            <h2 className={`text-lg font-semibold ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>
              Quick Editor - SQL Server
            </h2>
            <p className={`text-xs mt-1 ${isDark ? 'text-gray-500' : 'text-gray-600'}`}>
              {workflowStep === 'add-tables'
                ? 'Step 1: Add tables to your model'
                : `Step 2: Define table properties and columns  ${localTables.length} ${localTables.length === 1 ? 'table' : 'tables'}`}
            </p>
          </div>
          <div className="flex items-center gap-2">
            {workflowStep === 'edit-details' && (
              <button
                onClick={() => setWorkflowStep('add-tables')}
                className={`px-3 py-2 rounded-md text-xs font-medium transition-all inline-flex items-center gap-2 ${
                  isDark
                    ? 'bg-zinc-800 hover:bg-zinc-700 text-gray-300 border border-zinc-700'
                    : 'bg-gray-100 hover:bg-gray-200 text-gray-700 border border-gray-300'
                }`}
              >
                <Plus className="w-3.5 h-3.5" />
                Add More Tables
              </button>
            )}
          </div>
        </div>

        {/* Step 1: Add Tables */}
        {workflowStep === 'add-tables' && (
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            className={`border rounded-lg p-6 ${
              isDark ? 'border-zinc-800 bg-zinc-900/50' : 'border-gray-200 bg-white'
            }`}
          >
            <div className="flex items-start gap-4">
              <div className="flex-1">
                <label className={`block text-sm font-medium mb-2 ${isDark ? 'text-gray-200' : 'text-gray-700'}`}>
                  Table Names (one per line)
                </label>
                <textarea
                  value={newTableNames}
                  onChange={(e) => setNewTableNames(e.target.value)}
                  placeholder="Users&#10;Products&#10;Orders&#10;OrderDetails"
                  rows={8}
                  className={`w-full px-3 py-2 rounded-md text-sm font-mono border ${
                    isDark
                      ? 'bg-zinc-800 border-zinc-700 text-gray-100 placeholder-gray-500'
                      : 'bg-white border-gray-300 text-gray-900 placeholder-gray-400'
                  } focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                />
                <p className={`text-xs mt-2 ${isDark ? 'text-gray-500' : 'text-gray-600'}`}>
                  Enter each table name on a new line. Tables will be created with default SQL Server properties.
                </p>
              </div>
              <div className="w-80">
                <label className={`block text-sm font-medium mb-2 ${isDark ? 'text-gray-200' : 'text-gray-700'}`}>
                  Existing Tables ({localTables.length})
                </label>
                <div className={`border rounded-md max-h-64 overflow-y-auto ${
                  isDark ? 'border-zinc-700 bg-zinc-800' : 'border-gray-300 bg-gray-50'
                }`}>
                  {localTables.length === 0 ? (
                    <div className={`p-4 text-center text-xs ${isDark ? 'text-gray-500' : 'text-gray-400'}`}>
                      No tables yet
                    </div>
                  ) : (
                    <div className="divide-y divide-zinc-700">
                      {localTables.map(table => (
                        <div
                          key={table.id}
                          className={`px-3 py-2 flex items-center justify-between ${
                            isDark ? 'hover:bg-zinc-700' : 'hover:bg-gray-100'
                          }`}
                        >
                          <div className="flex items-center gap-2">
                            <Table2 className={`w-3.5 h-3.5 ${isDark ? 'text-indigo-400' : 'text-indigo-600'}`} />
                            <span className={`text-xs font-medium ${isDark ? 'text-gray-200' : 'text-gray-700'}`}>
                              {table.name}
                            </span>
                            <span className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>
                              ({table.columns.length} cols)
                            </span>
                          </div>
                          <button
                            onClick={() => handleRemoveTable(table.id)}
                            className={`p-1 rounded transition-colors ${
                              isDark ? 'text-gray-500 hover:text-red-400 hover:bg-red-500/10' : 'text-gray-400 hover:text-red-600 hover:bg-red-50'
                            }`}
                          >
                            <Trash2 className="w-3 h-3" />
                          </button>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
                <div className="mt-4 flex flex-col gap-2">
                  <button
                    onClick={handleAddTables}
                    disabled={!newTableNames.trim()}
                    className={`px-4 py-2 rounded-md text-xs font-medium transition-colors inline-flex items-center justify-center gap-2 ${
                      newTableNames.trim()
                        ? 'bg-indigo-600 text-white hover:bg-indigo-700'
                        : 'bg-zinc-700 text-gray-500 cursor-not-allowed'
                    }`}
                  >
                    <Plus className="w-3.5 h-3.5" />
                    Add Tables
                  </button>
                  {localTables.length > 0 && (
                    <button
                      onClick={() => {
                        setSelectedTableId(localTables[0].id);
                        setWorkflowStep('edit-details');
                      }}
                      className="px-4 py-2 bg-zinc-800 hover:bg-zinc-700 text-gray-200 rounded-md text-xs font-medium transition-colors"
                    >
                      Continue to Edit Tables 
                    </button>
                  )}
                </div>
              </div>
            </div>
          </motion.div>
        )}

        {/* Step 2: Edit Table Details */}
        {workflowStep === 'edit-details' && selectedTable && (
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            className="space-y-4"
          >
            {/* Table Selector */}
            <div className={`border rounded-lg p-4 ${
              isDark ? 'border-zinc-800 bg-zinc-900/50' : 'border-gray-200 bg-white'
            }`}>
              <label className={`block text-xs font-medium mb-2 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                Select Table to Edit
              </label>
              <select
                value={selectedTableId || ''}
                onChange={(e) => setSelectedTableId(e.target.value)}
                className={`w-full px-3 py-2 rounded-md text-sm border ${
                  isDark
                    ? 'bg-zinc-800 border-zinc-700 text-gray-100'
                    : 'bg-white border-gray-300 text-gray-900'
                } focus:outline-none focus:ring-2 focus:ring-indigo-500`}
              >
                {localTables.map(table => (
                  <option key={table.id} value={table.id}>
                    {table.name} ({table.columns.length} columns)
                  </option>
                ))}
              </select>
            </div>

            {/* Table Properties */}
            <div className={`border rounded-lg overflow-hidden ${
              isDark ? 'border-zinc-800 bg-zinc-900/50' : 'border-gray-200 bg-white'
            }`}>
              <div className={`px-4 py-3 border-b ${
                isDark ? 'bg-zinc-900 border-zinc-800' : 'bg-gray-50 border-gray-200'
              }`}>
                <h3 className={`text-sm font-semibold ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>
                  Table Properties
                </h3>
              </div>
              <div className="p-4 grid grid-cols-2 gap-4">
                <div>
                  <label className={`block text-xs font-medium mb-1 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                    Table Name *
                  </label>
                  <input
                    type="text"
                    value={selectedTable.name}
                    onChange={(e) => updateTableProperty('name', e.target.value)}
                    className={`w-full px-3 py-2 rounded-md text-sm border ${
                      isDark
                        ? 'bg-zinc-800 border-zinc-700 text-gray-100'
                        : 'bg-white border-gray-300 text-gray-900'
                    } focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                  />
                </div>
                <div>
                  <label className={`block text-xs font-medium mb-1 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                    Schema
                  </label>
                  <input
                    type="text"
                    value={selectedTable.schema || 'dbo'}
                    onChange={(e) => updateTableProperty('schema', e.target.value)}
                    className={`w-full px-3 py-2 rounded-md text-sm border ${
                      isDark
                        ? 'bg-zinc-800 border-zinc-700 text-gray-100'
                        : 'bg-white border-gray-300 text-gray-900'
                    } focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                  />
                </div>
                <div>
                  <label className={`block text-xs font-medium mb-1 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                    Table Type
                  </label>
                  <select
                    value={selectedTable.tableType || 'Disk Based'}
                    onChange={(e) => updateTableProperty('tableType', e.target.value)}
                    className={`w-full px-3 py-2 rounded-md text-sm border ${
                      isDark
                        ? 'bg-zinc-800 border-zinc-700 text-gray-100'
                        : 'bg-white border-gray-300 text-gray-900'
                    } focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                  >
                    <option>Disk Based</option>
                    <option>Memory Optimized</option>
                    <option>File Table</option>
                  </select>
                </div>
                <div>
                  <label className={`block text-xs font-medium mb-1 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                    Lock Escalation
                  </label>
                  <select
                    value={selectedTable.lockEscalation || 'AUTO'}
                    onChange={(e) => updateTableProperty('lockEscalation', e.target.value)}
                    className={`w-full px-3 py-2 rounded-md text-sm border ${
                      isDark
                        ? 'bg-zinc-800 border-zinc-700 text-gray-100'
                        : 'bg-white border-gray-300 text-gray-900'
                    } focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                  >
                    <option>AUTO</option>
                    <option>TABLE</option>
                    <option>DISABLE</option>
                  </select>
                </div>
                <div className="col-span-2">
                  <label className={`block text-xs font-medium mb-1 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                    Description
                  </label>
                  <textarea
                    value={selectedTable.description || ''}
                    onChange={(e) => updateTableProperty('description', e.target.value)}
                    rows={2}
                    className={`w-full px-3 py-2 rounded-md text-sm border ${
                      isDark
                        ? 'bg-zinc-800 border-zinc-700 text-gray-100'
                        : 'bg-white border-gray-300 text-gray-900'
                    } focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                  />
                </div>
              </div>
            </div>

            {/* Columns */}
            <div className={`border rounded-lg overflow-hidden ${
              isDark ? 'border-zinc-800 bg-zinc-900/50' : 'border-gray-200 bg-white'
            }`}>
              <div className={`px-4 py-3 border-b flex items-center justify-between ${
                isDark ? 'bg-zinc-900 border-zinc-800' : 'bg-gray-50 border-gray-200'
              }`}>
                <h3 className={`text-sm font-semibold ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>
                  Columns ({selectedTable.columns.length})
                </h3>
                <button
                  onClick={addColumn}
                  className="px-3 py-1.5 bg-indigo-600 text-white rounded-md text-xs font-medium hover:bg-indigo-700 transition-colors inline-flex items-center gap-1.5"
                >
                  <Plus className="w-3 h-3" />
                  Add Column
                </button>
              </div>
              <div className="overflow-x-auto">
                <table className="w-full text-xs">
                  <thead className={isDark ? 'bg-zinc-900 border-b border-zinc-800' : 'bg-gray-50 border-b border-gray-200'}>
                    <tr>
                      <th className={`px-3 py-2 text-left font-medium ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>Name</th>
                      <th className={`px-3 py-2 text-left font-medium ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>Data Type</th>
                      <th className={`px-3 py-2 text-center font-medium ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>PK</th>
                      <th className={`px-3 py-2 text-center font-medium ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>FK</th>
                      <th className={`px-3 py-2 text-center font-medium ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>Nullable</th>
                      <th className={`px-3 py-2 text-left font-medium ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>Default</th>
                      <th className={`px-3 py-2 text-center font-medium ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {selectedTable.columns.length === 0 ? (
                      <tr>
                        <td colSpan={7} className={`px-4 py-8 text-center ${isDark ? 'text-gray-500' : 'text-gray-400'}`}>
                          <FileText className="w-8 h-8 mx-auto mb-2 opacity-50" />
                          <p className="text-xs">No columns yet. Click "Add Column" to start.</p>
                        </td>
                      </tr>
                    ) : (
                      selectedTable.columns.map(col => (
                        <tr key={col.id} className={`border-b transition-colors ${
                          isDark ? 'border-zinc-800 hover:bg-zinc-800/50' : 'border-gray-200 hover:bg-gray-50'
                        }`}>
                          <td className="px-3 py-2">
                            <input
                              type="text"
                              value={col.name}
                              onChange={(e) => updateColumn(col.id, 'name', e.target.value)}
                              className={`w-full bg-transparent border rounded px-2 py-1 text-xs focus:outline-none ${
                                isDark ? 'border-zinc-700 text-gray-100 focus:border-indigo-500' : 'border-gray-300 text-gray-900 focus:border-indigo-500'
                              }`}
                            />
                          </td>
                          <td className="px-3 py-2">
                            <select
                              value={col.dataType}
                              onChange={(e) => updateColumn(col.id, 'dataType', e.target.value)}
                              className={`w-full bg-transparent border rounded px-2 py-1 text-xs focus:outline-none ${
                                isDark ? 'border-zinc-700 text-gray-100 focus:border-indigo-500' : 'border-gray-300 text-gray-900 focus:border-indigo-500'
                              }`}
                            >
                              {sqlServerDataTypes.map(type => (
                                <option key={type} value={type}>{type}</option>
                              ))}
                            </select>
                          </td>
                          <td className="px-3 py-2 text-center">
                            <input
                              type="checkbox"
                              checked={col.isPK}
                              onChange={(e) => updateColumn(col.id, 'isPK', e.target.checked)}
                              className={`rounded text-indigo-600 focus:ring-indigo-500 ${isDark ? 'border-zinc-600 bg-zinc-800' : 'border-gray-300 bg-white'}`}
                            />
                          </td>
                          <td className="px-3 py-2 text-center">
                            <input
                              type="checkbox"
                              checked={col.isFK || false}
                              onChange={(e) => updateColumn(col.id, 'isFK', e.target.checked)}
                              className={`rounded text-indigo-600 focus:ring-indigo-500 ${isDark ? 'border-zinc-600 bg-zinc-800' : 'border-gray-300 bg-white'}`}
                            />
                          </td>
                          <td className="px-3 py-2 text-center">
                            <input
                              type="checkbox"
                              checked={col.isNullable}
                              onChange={(e) => updateColumn(col.id, 'isNullable', e.target.checked)}
                              className={`rounded text-indigo-600 focus:ring-indigo-500 ${isDark ? 'border-zinc-600 bg-zinc-800' : 'border-gray-300 bg-white'}`}
                            />
                          </td>
                          <td className="px-3 py-2">
                            <input
                              type="text"
                              value={col.defaultValue || ''}
                              onChange={(e) => updateColumn(col.id, 'defaultValue', e.target.value)}
                              placeholder="NULL"
                              className={`w-full bg-transparent border rounded px-2 py-1 text-xs focus:outline-none ${
                                isDark ? 'border-zinc-700 text-gray-100 focus:border-indigo-500' : 'border-gray-300 text-gray-900 focus:border-indigo-500'
                              }`}
                            />
                          </td>
                          <td className="px-3 py-2 text-center">
                            <button
                              onClick={() => deleteColumn(col.id)}
                              className={`p-1 rounded transition-colors ${
                                isDark ? 'text-gray-400 hover:text-red-400 hover:bg-red-500/10' : 'text-gray-600 hover:text-red-600 hover:bg-red-50'
                              }`}
                            >
                              <Trash2 className="w-3 h-3" />
                            </button>
                          </td>
                        </tr>
                      ))
                    )}
                  </tbody>
                </table>
              </div>
            </div>
          </motion.div>
        )}

        {/* Save/Cancel Actions */}
        {localTables.length > 0 && (
          <div className={`mt-6 flex items-center justify-between pt-6 border-t ${isDark ? 'border-zinc-800' : 'border-gray-200'}`}>
            <div className="flex items-center gap-2">
              {hasUnsavedChanges && (
                <span className={`text-xs ${isDark ? 'text-amber-400' : 'text-amber-600'}`}>
                   Unsaved changes
                </span>
              )}
            </div>
            <div className="flex items-center gap-2">
              <button
                onClick={handleCancel}
                disabled={!hasUnsavedChanges}
                className={`px-4 py-2 rounded-md text-xs font-medium transition-colors ${
                  hasUnsavedChanges
                    ? isDark
                      ? 'bg-zinc-800 hover:bg-zinc-700 text-gray-300'
                      : 'bg-gray-200 hover:bg-gray-300 text-gray-700'
                    : 'bg-zinc-900 text-gray-600 cursor-not-allowed'
                }`}
              >
                Cancel
              </button>
              <button
                onClick={handleSave}
                disabled={!hasUnsavedChanges}
                className={`px-4 py-2 rounded-md text-xs font-medium transition-colors inline-flex items-center gap-2 ${
                  hasUnsavedChanges
                    ? 'bg-indigo-600 hover:bg-indigo-700 text-white'
                    : 'bg-indigo-900 text-indigo-400 cursor-not-allowed'
                }`}
              >
                <Save className="w-3.5 h-3.5" />
                Save & Update Diagram
              </button>
            </div>
          </div>
        )}
      </div>
    </motion.div>
  );
}
*/

// Properties View Component - Model Explorer + Context Properties
function PropertiesView({ selectedTable, isDark }: { selectedTable?: Table; isDark: boolean }) {
  const [searchTerm, setSearchTerm] = useState('');
  const [expandedItems, setExpandedItems] = useState<Set<string>>(new Set(['model', 'tables', 'relationships', 'table-users', 'table-orders']));
  const [selectedItem, setSelectedItem] = useState<{type: 'model' | 'table' | 'relationship' | 'column' | 'index' | 'constraint' | 'view', id?: string} | null>({ type: 'model' });
  const [activeTab, setActiveTab] = useState('general');
  const [saveStatus, setSaveStatus] = useState<'saved' | 'unsaved' | 'saving'>('saved');
  const [filterType, setFilterType] = useState<'all' | 'tables' | 'columns' | 'relationships'>('all');

  // Property values state - This makes properties editable and persistent
  const [properties, setProperties] = useState({
    modelName: 'E-Commerce Model',
    modelDescription: 'A comprehensive e-commerce data model supporting products, orders, and customers.',
    modelVersion: '1.0.0',
    modelAuthor: 'Data Team',
    modelSubjectArea: 'E-Commerce',
    modelDomain: 'Sales & Customer Management',
    modelOwner: 'Data Architecture Team',
    modelStatus: 'Active',
    tableName: 'Users',
    tableSchema: 'public',
    tableDescription: 'Stores user account information...',
  });

  // Columns state for the selected table
  const [columns, setColumns] = useState([
    { id: 'col-1', name: 'user_id', dataType: 'INTEGER', isPK: true, isFK: false, isNullable: false, defaultValue: '' },
    { id: 'col-2', name: 'username', dataType: 'VARCHAR(50)', isPK: false, isFK: false, isNullable: false, defaultValue: '' },
    { id: 'col-3', name: 'email', dataType: 'VARCHAR(100)', isPK: false, isFK: false, isNullable: false, defaultValue: '' },
    { id: 'col-4', name: 'created_at', dataType: 'TIMESTAMP', isPK: false, isFK: false, isNullable: false, defaultValue: 'CURRENT_TIMESTAMP' },
  ]);

  // Indexes state
  const [indexes, setIndexes] = useState([
    { id: 'idx-1', name: 'idx_users_email', table: 'Users', columns: ['email'], isUnique: true, type: 'BTREE' },
    { id: 'idx-2', name: 'idx_users_username', table: 'Users', columns: ['username'], isUnique: false, type: 'BTREE' },
  ]);

  // Constraints state
  const [constraints, setConstraints] = useState([
    { id: 'const-1', name: 'fk_orders_user', type: 'Foreign Key', table: 'Orders', referencedTable: 'Users', columns: 'user_id' },
    { id: 'const-2', name: 'chk_order_total', type: 'Check', table: 'Orders', condition: 'total_amount > 0', columns: 'total_amount' },
  ]);

  // Editing state
  const [editingColumn, setEditingColumn] = useState<any>(null);
  const [editingIndex, setEditingIndex] = useState<any>(null);
  const [editingConstraint, setEditingConstraint] = useState<any>(null);
  const [showColumnForm, setShowColumnForm] = useState(false);
  const [showIndexForm, setShowIndexForm] = useState(false);
  const [showConstraintForm, setShowConstraintForm] = useState(false);

  const handlePropertyChange = (key: string, value: string) => {
    setProperties(prev => ({ ...prev, [key]: value }));
    setSaveStatus('unsaved');
  };

  // Column CRUD operations
  const handleAddColumn = () => {
    setEditingColumn({
      id: `col-${Date.now()}`,
      name: '',
      dataType: 'VARCHAR(50)',
      isPK: false,
      isFK: false,
      isNullable: true,
      defaultValue: ''
    });
    setShowColumnForm(true);
  };

  const handleEditColumn = (column: any) => {
    setEditingColumn({ ...column });
    setShowColumnForm(true);
  };

  const handleSaveColumn = () => {
    if (editingColumn) {
      const existingIndex = columns.findIndex(c => c.id === editingColumn.id);
      if (existingIndex >= 0) {
        setColumns(prev => prev.map(c => c.id === editingColumn.id ? editingColumn : c));
      } else {
        setColumns(prev => [...prev, editingColumn]);
      }
      setShowColumnForm(false);
      setEditingColumn(null);
      setSaveStatus('unsaved');
    }
  };

  const handleDeleteColumn = (id: string) => {
    if (confirm('Are you sure you want to delete this column?')) {
      setColumns(prev => prev.filter(c => c.id !== id));
      setSaveStatus('unsaved');
    }
  };

  // Index CRUD operations
  const handleAddIndex = () => {
    setEditingIndex({
      id: `idx-${Date.now()}`,
      name: '',
      table: properties.tableName,
      columns: [],
      isUnique: false,
      type: 'BTREE'
    });
    setShowIndexForm(true);
  };

  const handleEditIndex = (index: any) => {
    setEditingIndex({ ...index });
    setShowIndexForm(true);
  };

  const handleSaveIndex = () => {
    if (editingIndex) {
      const existingIndex = indexes.findIndex(i => i.id === editingIndex.id);
      if (existingIndex >= 0) {
        setIndexes(prev => prev.map(i => i.id === editingIndex.id ? editingIndex : i));
      } else {
        setIndexes(prev => [...prev, editingIndex]);
      }
      setShowIndexForm(false);
      setEditingIndex(null);
      setSaveStatus('unsaved');
    }
  };

  const handleDeleteIndex = (id: string) => {
    if (confirm('Are you sure you want to delete this index?')) {
      setIndexes(prev => prev.filter(i => i.id !== id));
      setSaveStatus('unsaved');
    }
  };

  // Constraint CRUD operations
  const handleAddConstraint = () => {
    setEditingConstraint({
      id: `const-${Date.now()}`,
      name: '',
      type: 'Foreign Key',
      table: properties.tableName,
      referencedTable: '',
      columns: '',
      condition: ''
    });
    setShowConstraintForm(true);
  };

  const handleEditConstraint = (constraint: any) => {
    setEditingConstraint({ ...constraint });
    setShowConstraintForm(true);
  };

  const handleSaveConstraint = () => {
    if (editingConstraint) {
      const existingIndex = constraints.findIndex(c => c.id === editingConstraint.id);
      if (existingIndex >= 0) {
        setConstraints(prev => prev.map(c => c.id === editingConstraint.id ? editingConstraint : c));
      } else {
        setConstraints(prev => [...prev, editingConstraint]);
      }
      setShowConstraintForm(false);
      setEditingConstraint(null);
      setSaveStatus('unsaved');
    }
  };

  const handleDeleteConstraint = (id: string) => {
    if (confirm('Are you sure you want to delete this constraint?')) {
      setConstraints(prev => prev.filter(c => c.id !== id));
      setSaveStatus('unsaved');
    }
  };

  // Keyboard navigation and auto-save
  React.useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      // Ctrl/Cmd + S to save
      if ((e.ctrlKey || e.metaKey) && e.key === 's') {
        e.preventDefault();
        if (saveStatus === 'unsaved') {
          setSaveStatus('saving');
          setTimeout(() => setSaveStatus('saved'), 1000);
        }
      }
      // Escape to cancel/close
      if (e.key === 'Escape') {
        // Could add cancel edit logic here
      }
    };

    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, [saveStatus]);

  // Auto-save with debounce
  React.useEffect(() => {
    if (saveStatus === 'unsaved') {
      const timer = setTimeout(() => {
        setSaveStatus('saving');
        setTimeout(() => setSaveStatus('saved'), 800);
      }, 2000); // Auto-save after 2 seconds of inactivity

      return () => clearTimeout(timer);
    }
  }, [saveStatus]);

  // Dynamic tree data structure based on actual state
  const treeData = React.useMemo(() => [
    {
      id: 'model',
      label: properties.modelName,
      icon: Database,
      children: [
        { id: 'model-general', label: 'General', icon: FileText, type: 'model' as const },
        { id: 'model-settings', label: 'Settings', icon: Settings, type: 'model' as const },
        { id: 'model-metadata', label: 'Metadata', icon: FileCode, type: 'model' as const },
        { id: 'model-subject', label: 'Subject Area', icon: Folder, type: 'model' as const },
        { id: 'model-domain', label: 'Domain', icon: Globe, type: 'model' as const }
      ]
    },
    {
      id: 'tables',
      label: `Tables (1)`,
      icon: Table2,
      children: [
        {
          id: 'table-users',
          label: properties.tableName,
          icon: Users,
          type: 'table' as const,
          children: columns.map(col => ({
            id: col.id,
            label: `${col.name}${col.isPK ? ' (PK)' : col.isFK ? ' (FK)' : ''}`,
            icon: col.isPK ? Key : col.isFK ? LinkIcon : Type,
            type: 'column' as const
          }))
        }
      ]
    },
    {
      id: 'relationships',
      label: `Relationships (2)`,
      icon: GitBranch,
      children: [
        { id: 'rel-1', label: 'Users  Orders', icon: ArrowRight, type: 'relationship' as const },
        { id: 'rel-2', label: 'Orders  Products', icon: ArrowRight, type: 'relationship' as const }
      ]
    },
    {
      id: 'indexes',
      label: `Indexes (${indexes.length})`,
      icon: Zap,
      children: indexes.map(idx => ({
        id: idx.id,
        label: idx.name,
        icon: idx.isUnique ? KeyRound : Hash,
        type: 'index' as const
      }))
    },
    {
      id: 'constraints',
      label: `Constraints (${constraints.length})`,
      icon: Lock,
      children: constraints.map(con => ({
        id: con.id,
        label: con.name,
        icon: con.type === 'Foreign Key' ? LinkIcon : Settings,
        type: 'constraint' as const
      }))
    },
    {
      id: 'views',
      label: 'Views (2)',
      icon: Eye,
      children: [
        { id: 'view-1', label: 'vw_order_summary', icon: FileText, type: 'view' as const },
        { id: 'view-2', label: 'vw_user_stats', icon: FileText, type: 'view' as const }
      ]
    }
  ], [properties.modelName, properties.tableName, columns, indexes, constraints]);

  const TreeItem = ({ item, level = 0 }: { item: any; level?: number }) => {
    const isExpanded = expandedItems.has(item.id);
    const hasChildren = item.children && item.children.length > 0;
    const isSelected = selectedItem?.type === item.type && (item.type === 'model' || selectedItem?.id === item.id);

    return (
      <div className="relative">
        {/* Active highlight line */}
        {isSelected && (
          <div className="absolute left-0 top-0 bottom-0 w-0.5 bg-indigo-500 rounded-r" />
        )}
        <div
          className={`flex items-center gap-2 px-2 py-1.5 rounded-md cursor-pointer transition-all duration-200 group ${
            isSelected
              ? isDark ? 'bg-indigo-500/20 text-indigo-400 shadow-sm' : 'bg-indigo-100 text-indigo-700 shadow-sm'
              : isDark ? 'hover:bg-zinc-800/80 text-gray-300' : 'hover:bg-gray-100 text-gray-700'
          }`}
          style={{ paddingLeft: `${(level * 12) + 8}px` }}
          onClick={() => {
            if (hasChildren) {
              setExpandedItems(prev => {
                const next = new Set(prev);
                if (next.has(item.id)) {
                  next.delete(item.id);
                } else {
                  next.add(item.id);
                }
                return next;
              });
            }
            if (item.type) {
              setSelectedItem({ type: item.type, id: item.id });
              setActiveTab('general');
            }
          }}
          title={item.label}
        >
          {hasChildren && (
            <div className={`transition-transform duration-200 ${isExpanded ? 'rotate-0' : '-rotate-90'}`}>
              <ChevronDown className="w-3 h-3" />
            </div>
          )}
          {!hasChildren && <div className="w-3" />}
          <item.icon className={`w-3.5 h-3.5 transition-colors ${
            isSelected
              ? isDark ? 'text-indigo-400' : 'text-indigo-600'
              : isDark ? 'text-gray-400' : 'text-gray-500'
          }`} />
          <span className="text-xs font-medium">{item.label}</span>
          {hasChildren && level === 0 && (
            <div className={`ml-auto opacity-0 group-hover:opacity-100 transition-opacity ${
              isDark ? 'text-gray-500' : 'text-gray-400'
            }`}>
              <Plus className="w-3 h-3" />
            </div>
          )}
        </div>
        {hasChildren && isExpanded && (
          <div className="mt-0.5">
            {item.children.map((child: any) => (
              <TreeItem key={child.id} item={child} level={level + 1} />
            ))}
          </div>
        )}
      </div>
    );
  };

  const renderPropertiesContent = () => {
    if (!selectedItem) return null;

    // Tabs configuration - Context-sensitive
    const modelTabs = [
      { id: 'general', label: 'General', icon: FileText },
      { id: 'settings', label: 'Settings', icon: Settings },
      { id: 'metadata', label: 'Metadata', icon: FileCode },
      { id: 'subject', label: 'Subject', icon: Folder },
      { id: 'domain', label: 'Domain', icon: Globe }
    ];

    const tableTabs = [
      { id: 'general', label: 'General', icon: FileText },
      { id: 'columns', label: 'Columns', icon: Table2 },
      { id: 'keys', label: 'Keys', icon: KeyRound },
      { id: 'indexes', label: 'Indexes', icon: Zap },
      { id: 'display', label: 'Display', icon: Eye }
    ];

    const columnTabs = [
      { id: 'general', label: 'General', icon: FileText },
      { id: 'constraints', label: 'Constraints', icon: Lock },
      { id: 'display', label: 'Display', icon: Eye }
    ];

    const relationshipTabs = [
      { id: 'general', label: 'General', icon: FileText },
      { id: 'cardinality', label: 'Cardinality', icon: GitBranch }
    ];

    const indexTabs = [
      { id: 'general', label: 'General', icon: FileText },
      { id: 'columns', label: 'Columns', icon: Table2 }
    ];

    const viewTabs = [
      { id: 'general', label: 'General', icon: FileText },
      { id: 'sql', label: 'SQL', icon: FileCode }
    ];

    const tabs = selectedItem.type === 'model' ? modelTabs
                : selectedItem.type === 'table' ? tableTabs
                : selectedItem.type === 'column' ? columnTabs
                : selectedItem.type === 'index' ? indexTabs
                : selectedItem.type === 'view' ? viewTabs
                : relationshipTabs;

    return (
      <div className="flex h-full flex-col">
        {/* Left Icon Strip */}
        <div className="flex h-full">
          <div className={`w-6 border-r transition-colors flex flex-col ${
            isDark ? 'bg-zinc-900 border-zinc-800' : 'bg-white border-gray-200'
          }`}>
            {tabs.map((tab) => (
              <div
                key={tab.id}
                onClick={() => setActiveTab(tab.id)}
                className={`h-8 flex items-center justify-center cursor-pointer transition-all duration-200 ${
                  activeTab === tab.id
                    ? `${isDark ? 'bg-indigo-500 text-white' : 'bg-indigo-600 text-white'} shadow-sm`
                    : `${isDark ? 'text-gray-400 hover:text-gray-100 hover:bg-zinc-800/50' : 'text-gray-600 hover:text-gray-900 hover:bg-indigo-50/50'}`
                }`}
                title={tab.label}
                style={{ marginBottom: '1px' }}
              >
                <tab.icon className="w-3.5 h-3.5" />
              </div>
            ))}
          </div>

          {/* Main Content Area */}
          <div className={`flex-1 overflow-y-auto transition-colors ${
            isDark ? 'bg-zinc-900' : 'bg-white'
          }`}>
            {/* Enhanced Context Header with Breadcrumb */}
            <div className={`p-3 border-b transition-colors ${
              isDark ? 'border-zinc-800 bg-zinc-900/50' : 'border-gray-200 bg-gray-50'
            }`}>
              {/* Breadcrumb Trail */}
              <div className="flex items-center gap-1.5 mb-2">
                <Database className={`w-3 h-3 ${isDark ? 'text-indigo-400' : 'text-indigo-600'}`} />
                <span className={`text-xs ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>E-Commerce Model</span>
                {selectedItem.type !== 'model' && (
                  <>
                    <ChevronRight className={`w-3 h-3 ${isDark ? 'text-gray-600' : 'text-gray-400'}`} />
                    <span className={`text-xs ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                      {selectedItem.type === 'table' ? 'Tables' : selectedItem.type === 'relationship' ? 'Relationships' : selectedItem.type === 'column' ? 'Columns' : selectedItem.type === 'index' ? 'Indexes' : selectedItem.type === 'constraint' ? 'Constraints' : 'Views'}
                    </span>
                    <ChevronRight className={`w-3 h-3 ${isDark ? 'text-gray-600' : 'text-gray-400'}`} />
                    <span className={`text-xs font-medium ${isDark ? 'text-gray-200' : 'text-gray-900'}`}>
                      {selectedItem.type === 'table' ? 'Users' : selectedItem.type === 'column' ? 'user_id' : selectedItem.type === 'relationship' ? 'Users  Orders' : 'Properties'}
                    </span>
                  </>
                )}
              </div>

              {/* Title with inline editing and status */}
              <div className="flex items-center justify-between gap-3">
                <div className="flex items-center gap-2 flex-1">
                  {React.createElement(tabs.find(tab => tab.id === activeTab)!.icon, {
                    className: `w-4 h-4 ${isDark ? 'text-indigo-400' : 'text-indigo-600'}`
                  })}
                  <h2 className={`text-sm font-semibold ${
                    isDark ? 'text-gray-100' : 'text-gray-900'
                  }`}>
                    {tabs.find(t => t.id === activeTab)?.label} Properties
                  </h2>
                </div>

                {/* Status Tag */}
                <div className={`flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium ${
                  saveStatus === 'saved'
                    ? isDark ? 'bg-green-500/20 text-green-400' : 'bg-green-100 text-green-700'
                    : saveStatus === 'saving'
                    ? isDark ? 'bg-yellow-500/20 text-yellow-400' : 'bg-yellow-100 text-yellow-700'
                    : isDark ? 'bg-orange-500/20 text-orange-400' : 'bg-orange-100 text-orange-700'
                }`}>
                  {saveStatus === 'saved' && ' Saved'}
                  {saveStatus === 'saving' && ' Saving...'}
                  {saveStatus === 'unsaved' && ' Unsaved'}
                </div>
              </div>
            </div>

            {/* Content with Section Cards */}
            <div className="p-4 space-y-4">
              {/* Model Properties */}
              {selectedItem.type === 'model' && activeTab === 'general' && (
                <div className="space-y-4">
                  {/* General Info Card */}
                  <div className={`rounded-lg border p-3 shadow-sm ${
                    isDark ? 'bg-zinc-900/50 border-zinc-800' : 'bg-white border-gray-200'
                  }`}>
                    <h3 className={`text-xs font-semibold mb-3 flex items-center gap-1.5 ${
                      isDark ? 'text-gray-200' : 'text-gray-800'
                    }`}>
                      <FileText className="w-3.5 h-3.5" />
                      General Information
                    </h3>
                    <div className="space-y-3">
                      <div>
                        <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                          Model Name <span className="text-red-500">*</span>
                        </label>
                        <input
                          type="text"
                          value={properties.modelName}
                          onChange={(e) => handlePropertyChange('modelName', e.target.value)}
                          className={`w-full px-3 py-2 text-xs rounded-md border transition-all ${
                            isDark ? 'bg-zinc-800 border-zinc-700 text-white focus:border-indigo-500 focus:bg-zinc-800/80'
                                   : 'bg-white border-gray-300 text-gray-900 focus:border-indigo-500 focus:bg-gray-50'
                          } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
                        />
                      </div>
                      <div>
                        <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                          Description
                        </label>
                        <textarea
                          rows={3}
                          value={properties.modelDescription}
                          onChange={(e) => handlePropertyChange('modelDescription', e.target.value)}
                          className={`w-full px-3 py-2 text-xs rounded-md border transition-all resize-none ${
                            isDark ? 'bg-zinc-800 border-zinc-700 text-white focus:border-indigo-500 focus:bg-zinc-800/80'
                                   : 'bg-white border-gray-300 text-gray-900 focus:border-indigo-500 focus:bg-gray-50'
                          } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
                          placeholder="Describe your data model..."
                        />
                      </div>
                    </div>
                  </div>

                  {/* Metadata Card - Two Column Layout */}
                  <div className={`rounded-lg border p-3 shadow-sm ${
                    isDark ? 'bg-zinc-900/50 border-zinc-800' : 'bg-white border-gray-200'
                  }`}>
                    <h3 className={`text-xs font-semibold mb-3 flex items-center gap-1.5 ${
                      isDark ? 'text-gray-200' : 'text-gray-800'
                    }`}>
                      <FileCode className="w-3.5 h-3.5" />
                      Metadata
                    </h3>
                    <div className="grid grid-cols-2 gap-3">
                      <div>
                        <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                          Version
                        </label>
                        <input
                          type="text"
                          value={properties.modelVersion}
                          onChange={(e) => handlePropertyChange('modelVersion', e.target.value)}
                          className={`w-full px-3 py-2 text-xs rounded-md border transition-all ${
                            isDark ? 'bg-zinc-800 border-zinc-700 text-white focus:border-indigo-500'
                                   : 'bg-white border-gray-300 text-gray-900 focus:border-indigo-500'
                          } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
                        />
                      </div>
                      <div>
                        <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                          Author
                        </label>
                        <input
                          type="text"
                          value={properties.modelAuthor}
                          onChange={(e) => handlePropertyChange('modelAuthor', e.target.value)}
                          className={`w-full px-3 py-2 text-xs rounded-md border transition-all ${
                            isDark ? 'bg-zinc-800 border-zinc-700 text-white focus:border-indigo-500'
                                   : 'bg-white border-gray-300 text-gray-900 focus:border-indigo-500'
                          } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
                        />
                      </div>
                      <div>
                        <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                          Created Date
                        </label>
                        <input
                          type="date"
                          defaultValue="2024-01-15"
                          onChange={() => setSaveStatus('unsaved')}
                          className={`w-full px-3 py-2 text-xs rounded-md border transition-all ${
                            isDark ? 'bg-zinc-800 border-zinc-700 text-white focus:border-indigo-500'
                                   : 'bg-white border-gray-300 text-gray-900 focus:border-indigo-500'
                          } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
                        />
                      </div>
                      <div>
                        <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                          Last Modified
                        </label>
                        <input
                          type="date"
                          defaultValue="2024-02-10"
                          disabled
                          className={`w-full px-3 py-2 text-xs rounded-md border transition-all opacity-60 cursor-not-allowed ${
                            isDark ? 'bg-zinc-800/50 border-zinc-700 text-white'
                                   : 'bg-gray-100 border-gray-300 text-gray-900'
                          }`}
                        />
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {selectedItem.type === 'model' && activeTab === 'settings' && (
                <div className="space-y-4">
                  <div className={`rounded-lg border p-3 shadow-sm ${
                    isDark ? 'bg-zinc-900/50 border-zinc-800' : 'bg-white border-gray-200'
                  }`}>
                    <h3 className={`text-xs font-semibold mb-3 flex items-center gap-1.5 ${
                      isDark ? 'text-gray-200' : 'text-gray-800'
                    }`}>
                      <Settings className="w-3.5 h-3.5" />
                      Display Settings
                    </h3>
                    <div className="space-y-2.5">
                      <div className="flex items-center gap-2">
                        <input type="checkbox" id="autoLayout" className="rounded w-4 h-4" />
                        <label htmlFor="autoLayout" className={`text-xs ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                          Enable Auto Layout
                        </label>
                      </div>
                      <div className="flex items-center gap-2">
                        <input type="checkbox" id="showGrid" defaultChecked className="rounded w-4 h-4" />
                        <label htmlFor="showGrid" className={`text-xs ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                          Show Grid Lines
                        </label>
                      </div>
                      <div className="flex items-center gap-2">
                        <input type="checkbox" id="snapToGrid" className="rounded w-4 h-4" />
                        <label htmlFor="snapToGrid" className={`text-xs ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                          Snap Elements to Grid
                        </label>
                      </div>
                      <div className="flex items-center gap-2">
                        <input type="checkbox" id="showRelLabels" defaultChecked className="rounded w-4 h-4" />
                        <label htmlFor="showRelLabels" className={`text-xs ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                          Show Relationship Labels
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {selectedItem.type === 'model' && activeTab === 'metadata' && (
                <div className="space-y-4">
                  <div className={`rounded-lg border p-3 shadow-sm ${
                    isDark ? 'bg-zinc-900/50 border-zinc-800' : 'bg-white border-gray-200'
                  }`}>
                    <h3 className={`text-xs font-semibold mb-3 flex items-center gap-1.5 ${
                      isDark ? 'text-gray-200' : 'text-gray-800'
                    }`}>
                      <FileCode className="w-3.5 h-3.5" />
                      Business Metadata
                    </h3>
                    <div className="space-y-3">
                      <div>
                        <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                          Model Owner
                        </label>
                        <input
                          type="text"
                          value={properties.modelOwner}
                          onChange={(e) => handlePropertyChange('modelOwner', e.target.value)}
                          className={`w-full px-3 py-2 text-xs rounded-md border transition-all ${
                            isDark ? 'bg-zinc-800 border-zinc-700 text-white focus:border-indigo-500'
                                   : 'bg-white border-gray-300 text-gray-900 focus:border-indigo-500'
                          } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
                        />
                      </div>
                      <div>
                        <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                          Status
                        </label>
                        <select
                          value={properties.modelStatus}
                          onChange={(e) => handlePropertyChange('modelStatus', e.target.value)}
                          className={`w-full px-3 py-2 text-xs rounded-md border transition-all ${
                            isDark ? 'bg-zinc-800 border-zinc-700 text-white focus:border-indigo-500'
                                   : 'bg-white border-gray-300 text-gray-900 focus:border-indigo-500'
                          } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
                        >
                          <option>Active</option>
                          <option>Draft</option>
                          <option>Deprecated</option>
                          <option>Archived</option>
                        </select>
                      </div>
                      <div>
                        <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                          Tags
                        </label>
                        <input
                          type="text"
                          placeholder="production, customer-data, pii"
                          className={`w-full px-3 py-2 text-xs rounded-md border transition-all ${
                            isDark ? 'bg-zinc-800 border-zinc-700 text-white focus:border-indigo-500'
                                   : 'bg-white border-gray-300 text-gray-900 focus:border-indigo-500'
                          } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
                        />
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {selectedItem.type === 'model' && activeTab === 'subject' && (
                <div className="space-y-4">
                  <div className={`rounded-lg border p-3 shadow-sm ${
                    isDark ? 'bg-zinc-900/50 border-zinc-800' : 'bg-white border-gray-200'
                  }`}>
                    <h3 className={`text-xs font-semibold mb-3 flex items-center gap-1.5 ${
                      isDark ? 'text-gray-200' : 'text-gray-800'
                    }`}>
                      <Folder className="w-3.5 h-3.5" />
                      Subject Area
                    </h3>
                    <div className="space-y-3">
                      <div>
                        <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                          Subject Area <span className="text-red-500">*</span>
                        </label>
                        <select
                          value={properties.modelSubjectArea}
                          onChange={(e) => handlePropertyChange('modelSubjectArea', e.target.value)}
                          className={`w-full px-3 py-2 text-xs rounded-md border transition-all ${
                            isDark ? 'bg-zinc-800 border-zinc-700 text-white focus:border-indigo-500'
                                   : 'bg-white border-gray-300 text-gray-900 focus:border-indigo-500'
                          } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
                        >
                          <option>E-Commerce</option>
                          <option>Finance</option>
                          <option>Healthcare</option>
                          <option>Marketing</option>
                          <option>Human Resources</option>
                          <option>Supply Chain</option>
                        </select>
                      </div>
                      <div>
                        <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                          Description
                        </label>
                        <textarea
                          rows={3}
                          placeholder="Describe the subject area scope and purpose..."
                          className={`w-full px-3 py-2 text-xs rounded-md border transition-all resize-none ${
                            isDark ? 'bg-zinc-800 border-zinc-700 text-white focus:border-indigo-500'
                                   : 'bg-white border-gray-300 text-gray-900 focus:border-indigo-500'
                          } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
                          defaultValue="Covers all aspects of online commerce including product catalog, order management, and customer transactions."
                        />
                      </div>
                      <div>
                        <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                          Business Owner
                        </label>
                        <input
                          type="text"
                          placeholder="Enter business owner name"
                          defaultValue="Product Management Team"
                          className={`w-full px-3 py-2 text-xs rounded-md border transition-all ${
                            isDark ? 'bg-zinc-800 border-zinc-700 text-white focus:border-indigo-500'
                                   : 'bg-white border-gray-300 text-gray-900 focus:border-indigo-500'
                          } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
                        />
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {selectedItem.type === 'model' && activeTab === 'domain' && (
                <div className="space-y-4">
                  <div className={`rounded-lg border p-3 shadow-sm ${
                    isDark ? 'bg-zinc-900/50 border-zinc-800' : 'bg-white border-gray-200'
                  }`}>
                    <h3 className={`text-xs font-semibold mb-3 flex items-center gap-1.5 ${
                      isDark ? 'text-gray-200' : 'text-gray-800'
                    }`}>
                      <Globe className="w-3.5 h-3.5" />
                      Domain
                    </h3>
                    <div className="space-y-3">
                      <div>
                        <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                          Business Domain <span className="text-red-500">*</span>
                        </label>
                        <input
                          type="text"
                          value={properties.modelDomain}
                          onChange={(e) => handlePropertyChange('modelDomain', e.target.value)}
                          className={`w-full px-3 py-2 text-xs rounded-md border transition-all ${
                            isDark ? 'bg-zinc-800 border-zinc-700 text-white focus:border-indigo-500'
                                   : 'bg-white border-gray-300 text-gray-900 focus:border-indigo-500'
                          } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
                        />
                      </div>
                      <div>
                        <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                          Domain Category
                        </label>
                        <select
                          className={`w-full px-3 py-2 text-xs rounded-md border transition-all ${
                            isDark ? 'bg-zinc-800 border-zinc-700 text-white focus:border-indigo-500'
                                   : 'bg-white border-gray-300 text-gray-900 focus:border-indigo-500'
                          } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
                        >
                          <option>Operational</option>
                          <option>Analytical</option>
                          <option>Master Data</option>
                          <option>Reference Data</option>
                        </select>
                      </div>
                      <div>
                        <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                          Domain Description
                        </label>
                        <textarea
                          rows={3}
                          placeholder="Describe the business domain..."
                          className={`w-full px-3 py-2 text-xs rounded-md border transition-all resize-none ${
                            isDark ? 'bg-zinc-800 border-zinc-700 text-white focus:border-indigo-500'
                                   : 'bg-white border-gray-300 text-gray-900 focus:border-indigo-500'
                          } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
                          defaultValue="Manages all sales-related activities and customer relationship management within the e-commerce platform."
                        />
                      </div>
                      <div>
                        <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                          Data Steward
                        </label>
                        <input
                          type="text"
                          placeholder="Enter data steward name"
                          defaultValue="John Doe"
                          className={`w-full px-3 py-2 text-xs rounded-md border transition-all ${
                            isDark ? 'bg-zinc-800 border-zinc-700 text-white focus:border-indigo-500'
                                   : 'bg-white border-gray-300 text-gray-900 focus:border-indigo-500'
                          } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
                        />
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {/* Table Properties */}
              {selectedItem.type === 'table' && activeTab === 'general' && (
                <div className="space-y-4">
                  {/* Basic Info Card */}
                  <div className={`rounded-lg border p-3 shadow-sm ${
                    isDark ? 'bg-zinc-900/50 border-zinc-800' : 'bg-white border-gray-200'
                  }`}>
                    <h3 className={`text-xs font-semibold mb-3 flex items-center gap-1.5 ${
                      isDark ? 'text-gray-200' : 'text-gray-800'
                    }`}>
                      <Table2 className="w-3.5 h-3.5" />
                      Table Information
                    </h3>
                    <div className="grid grid-cols-2 gap-3">
                      <div className="col-span-2">
                        <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                          Table Name <span className="text-red-500">*</span>
                        </label>
                        <input
                          type="text"
                          value={properties.tableName}
                          onChange={(e) => handlePropertyChange('tableName', e.target.value)}
                          className={`w-full px-3 py-2 text-xs rounded-md border transition-all ${
                            isDark ? 'bg-zinc-800 border-zinc-700 text-white focus:border-indigo-500'
                                   : 'bg-white border-gray-300 text-gray-900 focus:border-indigo-500'
                          } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
                        />
                      </div>
                      <div>
                        <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                          Schema
                        </label>
                        <input
                          type="text"
                          value={properties.tableSchema}
                          onChange={(e) => handlePropertyChange('tableSchema', e.target.value)}
                          className={`w-full px-3 py-2 text-xs rounded-md border transition-all ${
                            isDark ? 'bg-zinc-800 border-zinc-700 text-white focus:border-indigo-500'
                                   : 'bg-white border-gray-300 text-gray-900 focus:border-indigo-500'
                          } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
                        />
                      </div>
                      <div>
                        <label className={`block text-xs font-medium mb-1.5 flex items-center gap-1 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                          Type
                          <span className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-400'}`} title="Table type"></span>
                        </label>
                        <select
                          onChange={() => setSaveStatus('unsaved')}
                          className={`w-full px-3 py-2 text-xs rounded-md border transition-all ${
                            isDark ? 'bg-zinc-800 border-zinc-700 text-white focus:border-indigo-500'
                                   : 'bg-white border-gray-300 text-gray-900 focus:border-indigo-500'
                          } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
                        >
                          <option>Standard Table</option>
                          <option>View</option>
                          <option>Materialized View</option>
                        </select>
                      </div>
                      <div className="col-span-2">
                        <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                          Description
                        </label>
                        <textarea
                          rows={2}
                          value={properties.tableDescription}
                          onChange={(e) => handlePropertyChange('tableDescription', e.target.value)}
                          className={`w-full px-3 py-2 text-xs rounded-md border transition-all resize-none ${
                            isDark ? 'bg-zinc-800 border-zinc-700 text-white focus:border-indigo-500'
                                   : 'bg-white border-gray-300 text-gray-900 focus:border-indigo-500'
                          } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
                          placeholder="Stores user account information..."
                        />
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {selectedItem.type === 'table' && activeTab === 'columns' && (
                <div className="space-y-4">
                  {/* Columns Table Card */}
                  <div className={`rounded-lg border shadow-sm ${
                    isDark ? 'bg-zinc-900/50 border-zinc-800' : 'bg-white border-gray-200'
                  }`}>
                    <div className={`p-3 border-b flex items-center justify-between ${
                      isDark ? 'border-zinc-800' : 'border-gray-200'
                    }`}>
                      <h3 className={`text-xs font-semibold flex items-center gap-1.5 ${
                        isDark ? 'text-gray-200' : 'text-gray-800'
                      }`}>
                        <Table2 className="w-3.5 h-3.5" />
                        Columns ({columns.length})
                      </h3>
                      <button
                        onClick={handleAddColumn}
                        className={`flex items-center gap-1.5 px-2.5 py-1.5 text-xs font-medium rounded-md transition-all ${
                          isDark ? 'bg-indigo-500 hover:bg-indigo-600 text-white' : 'bg-indigo-600 hover:bg-indigo-700 text-white'
                        }`}
                      >
                        <Plus className="w-3.5 h-3.5" />
                        Add Column
                      </button>
                    </div>

                    {/* Columns Table */}
                    <div className="overflow-x-auto">
                      <table className="w-full text-xs">
                        <thead className={isDark ? 'bg-zinc-800/50' : 'bg-gray-50'}>
                          <tr>
                            <th className={`px-3 py-2 text-left font-semibold ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>Name</th>
                            <th className={`px-3 py-2 text-left font-semibold ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>Data Type</th>
                            <th className={`px-3 py-2 text-center font-semibold ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>PK</th>
                            <th className={`px-3 py-2 text-center font-semibold ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>FK</th>
                            <th className={`px-3 py-2 text-center font-semibold ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>Nullable</th>
                            <th className={`px-3 py-2 text-left font-semibold ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>Default</th>
                            <th className={`px-3 py-2 text-right font-semibold ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>Actions</th>
                          </tr>
                        </thead>
                        <tbody>
                          {columns.map((col, idx) => (
                            <tr key={col.id} className={`border-t transition-colors ${
                              isDark ? 'border-zinc-800 hover:bg-zinc-800/30' : 'border-gray-200 hover:bg-gray-50'
                            }`}>
                              <td className={`px-3 py-2.5 font-medium ${isDark ? 'text-gray-200' : 'text-gray-900'}`}>
                                {col.name}
                              </td>
                              <td className={`px-3 py-2.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                                {col.dataType}
                              </td>
                              <td className="px-3 py-2.5 text-center">
                                {col.isPK && <Key className={`w-3.5 h-3.5 inline ${isDark ? 'text-yellow-400' : 'text-yellow-600'}`} />}
                              </td>
                              <td className="px-3 py-2.5 text-center">
                                {col.isFK && <LinkIcon className={`w-3.5 h-3.5 inline ${isDark ? 'text-blue-400' : 'text-blue-600'}`} />}
                              </td>
                              <td className="px-3 py-2.5 text-center">
                                {col.isNullable ? '' : ''}
                              </td>
                              <td className={`px-3 py-2.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                                {col.defaultValue || '-'}
                              </td>
                              <td className="px-3 py-2.5 text-right">
                                <div className="flex items-center justify-end gap-1">
                                  <button
                                    onClick={() => handleEditColumn(col)}
                                    className={`p-1 rounded transition-colors ${
                                      isDark ? 'hover:bg-zinc-700 text-gray-400 hover:text-gray-200' : 'hover:bg-gray-200 text-gray-600 hover:text-gray-900'
                                    }`}
                                    title="Edit column"
                                  >
                                    <Edit3 className="w-3.5 h-3.5" />
                                  </button>
                                  <button
                                    onClick={() => handleDeleteColumn(col.id)}
                                    className={`p-1 rounded transition-colors ${
                                      isDark ? 'hover:bg-red-500/20 text-gray-400 hover:text-red-400' : 'hover:bg-red-50 text-gray-600 hover:text-red-600'
                                    }`}
                                    title="Delete column"
                                  >
                                    <Trash2 className="w-3.5 h-3.5" />
                                  </button>
                                </div>
                              </td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </div>

                  {/* Column Edit Form Modal */}
                  <AnimatePresence>
                    {showColumnForm && editingColumn && (
                      <motion.div
                        initial={{ opacity: 0 }}
                        animate={{ opacity: 1 }}
                        exit={{ opacity: 0 }}
                        className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50"
                        onClick={() => setShowColumnForm(false)}
                      >
                        <motion.div
                          initial={{ scale: 0.95, opacity: 0 }}
                          animate={{ scale: 1, opacity: 1 }}
                          exit={{ scale: 0.95, opacity: 0 }}
                          onClick={(e) => e.stopPropagation()}
                          className={`w-full max-w-md rounded-lg shadow-xl ${
                            isDark ? 'bg-zinc-900 border border-zinc-800' : 'bg-white border border-gray-200'
                          }`}
                        >
                          <div className={`p-4 border-b ${isDark ? 'border-zinc-800' : 'border-gray-200'}`}>
                            <h3 className={`text-sm font-semibold ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>
                              {columns.some(c => c.id === editingColumn.id) ? 'Edit Column' : 'Add New Column'}
                            </h3>
                          </div>
                          <div className="p-4 space-y-3">
                            <div>
                              <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                                Column Name <span className="text-red-500">*</span>
                              </label>
                              <input
                                type="text"
                                value={editingColumn.name}
                                onChange={(e) => setEditingColumn({ ...editingColumn, name: e.target.value })}
                                className={`w-full px-3 py-2 text-xs rounded-md border ${
                                  isDark ? 'bg-zinc-800 border-zinc-700 text-white' : 'bg-white border-gray-300 text-gray-900'
                                } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
                                placeholder="column_name"
                              />
                            </div>
                            <div>
                              <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                                Data Type <span className="text-red-500">*</span>
                              </label>
                              <select
                                value={editingColumn.dataType}
                                onChange={(e) => setEditingColumn({ ...editingColumn, dataType: e.target.value })}
                                className={`w-full px-3 py-2 text-xs rounded-md border ${
                                  isDark ? 'bg-zinc-800 border-zinc-700 text-white' : 'bg-white border-gray-300 text-gray-900'
                                } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
                              >
                                <option>VARCHAR(50)</option>
                                <option>VARCHAR(100)</option>
                                <option>VARCHAR(255)</option>
                                <option>INTEGER</option>
                                <option>BIGINT</option>
                                <option>DECIMAL(10,2)</option>
                                <option>BOOLEAN</option>
                                <option>DATE</option>
                                <option>TIMESTAMP</option>
                                <option>TEXT</option>
                                <option>JSON</option>
                              </select>
                            </div>
                            <div className="grid grid-cols-3 gap-3">
                              <div className="flex items-center gap-2">
                                <input
                                  type="checkbox"
                                  id="isPK"
                                  checked={editingColumn.isPK}
                                  onChange={(e) => setEditingColumn({ ...editingColumn, isPK: e.target.checked })}
                                  className="rounded w-4 h-4"
                                />
                                <label htmlFor="isPK" className={`text-xs ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                                  Primary Key
                                </label>
                              </div>
                              <div className="flex items-center gap-2">
                                <input
                                  type="checkbox"
                                  id="isFK"
                                  checked={editingColumn.isFK}
                                  onChange={(e) => setEditingColumn({ ...editingColumn, isFK: e.target.checked })}
                                  className="rounded w-4 h-4"
                                />
                                <label htmlFor="isFK" className={`text-xs ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                                  Foreign Key
                                </label>
                              </div>
                              <div className="flex items-center gap-2">
                                <input
                                  type="checkbox"
                                  id="isNullable"
                                  checked={editingColumn.isNullable}
                                  onChange={(e) => setEditingColumn({ ...editingColumn, isNullable: e.target.checked })}
                                  className="rounded w-4 h-4"
                                />
                                <label htmlFor="isNullable" className={`text-xs ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                                  Nullable
                                </label>
                              </div>
                            </div>
                            <div>
                              <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                                Default Value
                              </label>
                              <input
                                type="text"
                                value={editingColumn.defaultValue}
                                onChange={(e) => setEditingColumn({ ...editingColumn, defaultValue: e.target.value })}
                                className={`w-full px-3 py-2 text-xs rounded-md border ${
                                  isDark ? 'bg-zinc-800 border-zinc-700 text-white' : 'bg-white border-gray-300 text-gray-900'
                                } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
                                placeholder="NULL, CURRENT_TIMESTAMP, etc."
                              />
                            </div>
                          </div>
                          <div className={`p-4 border-t flex justify-end gap-2 ${isDark ? 'border-zinc-800' : 'border-gray-200'}`}>
                            <button
                              onClick={() => setShowColumnForm(false)}
                              className={`px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${
                                isDark ? 'bg-zinc-800 hover:bg-zinc-700 text-gray-300' : 'bg-gray-100 hover:bg-gray-200 text-gray-700'
                              }`}
                            >
                              Cancel
                            </button>
                            <button
                              onClick={handleSaveColumn}
                              className={`px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${
                                isDark ? 'bg-indigo-500 hover:bg-indigo-600 text-white' : 'bg-indigo-600 hover:bg-indigo-700 text-white'
                              }`}
                            >
                              Save Column
                            </button>
                          </div>
                        </motion.div>
                      </motion.div>
                    )}
                  </AnimatePresence>
                </div>
              )}

              {selectedItem.type === 'table' && activeTab === 'keys' && (
                <div className="space-y-4">
                  <div className={`rounded-lg border p-3 shadow-sm ${
                    isDark ? 'bg-zinc-900/50 border-zinc-800' : 'bg-white border-gray-200'
                  }`}>
                    <h3 className={`text-xs font-semibold mb-3 flex items-center gap-1.5 ${
                      isDark ? 'text-gray-200' : 'text-gray-800'
                    }`}>
                      <KeyRound className="w-3.5 h-3.5" />
                      Keys
                    </h3>
                    <div className="space-y-3">
                      <div>
                        <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                          Primary Key
                        </label>
                        <div className={`px-3 py-2 rounded-md text-xs font-mono ${isDark ? 'bg-zinc-800 text-gray-300' : 'bg-gray-100 text-gray-700'}`}>
                          {columns.filter(c => c.isPK).map(c => c.name).join(', ') || 'No primary key defined'}
                        </div>
                      </div>
                      <div>
                        <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                          Foreign Keys
                        </label>
                        <div className={`px-3 py-2 rounded-md text-xs font-mono ${isDark ? 'bg-zinc-800 text-gray-300' : 'bg-gray-100 text-gray-700'}`}>
                          {columns.filter(c => c.isFK).map(c => c.name).join(', ') || 'No foreign keys defined'}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {selectedItem.type === 'table' && activeTab === 'indexes' && (
                <div className="space-y-4">
                  {/* Indexes Table Card */}
                  <div className={`rounded-lg border shadow-sm ${
                    isDark ? 'bg-zinc-900/50 border-zinc-800' : 'bg-white border-gray-200'
                  }`}>
                    <div className={`p-3 border-b flex items-center justify-between ${
                      isDark ? 'border-zinc-800' : 'border-gray-200'
                    }`}>
                      <h3 className={`text-xs font-semibold flex items-center gap-1.5 ${
                        isDark ? 'text-gray-200' : 'text-gray-800'
                      }`}>
                        <Zap className="w-3.5 h-3.5" />
                        Indexes ({indexes.length})
                      </h3>
                      <button
                        onClick={handleAddIndex}
                        className={`flex items-center gap-1.5 px-2.5 py-1.5 text-xs font-medium rounded-md transition-all ${
                          isDark ? 'bg-indigo-500 hover:bg-indigo-600 text-white' : 'bg-indigo-600 hover:bg-indigo-700 text-white'
                        }`}
                      >
                        <Plus className="w-3.5 h-3.5" />
                        Add Index
                      </button>
                    </div>

                    {/* Indexes Table */}
                    <div className="overflow-x-auto">
                      <table className="w-full text-xs">
                        <thead className={isDark ? 'bg-zinc-800/50' : 'bg-gray-50'}>
                          <tr>
                            <th className={`px-3 py-2 text-left font-semibold ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>Name</th>
                            <th className={`px-3 py-2 text-left font-semibold ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>Columns</th>
                            <th className={`px-3 py-2 text-center font-semibold ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>Unique</th>
                            <th className={`px-3 py-2 text-left font-semibold ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>Type</th>
                            <th className={`px-3 py-2 text-right font-semibold ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>Actions</th>
                          </tr>
                        </thead>
                        <tbody>
                          {indexes.filter(idx => idx.table === properties.tableName).map((idx) => (
                            <tr key={idx.id} className={`border-t transition-colors ${
                              isDark ? 'border-zinc-800 hover:bg-zinc-800/30' : 'border-gray-200 hover:bg-gray-50'
                            }`}>
                              <td className={`px-3 py-2.5 font-medium ${isDark ? 'text-gray-200' : 'text-gray-900'}`}>
                                {idx.name}
                              </td>
                              <td className={`px-3 py-2.5 font-mono ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                                {Array.isArray(idx.columns) ? idx.columns.join(', ') : idx.columns}
                              </td>
                              <td className="px-3 py-2.5 text-center">
                                {idx.isUnique ? '' : ''}
                              </td>
                              <td className={`px-3 py-2.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                                {idx.type}
                              </td>
                              <td className="px-3 py-2.5 text-right">
                                <div className="flex items-center justify-end gap-1">
                                  <button
                                    onClick={() => handleEditIndex(idx)}
                                    className={`p-1 rounded transition-colors ${
                                      isDark ? 'hover:bg-zinc-700 text-gray-400 hover:text-gray-200' : 'hover:bg-gray-200 text-gray-600 hover:text-gray-900'
                                    }`}
                                    title="Edit index"
                                  >
                                    <Edit3 className="w-3.5 h-3.5" />
                                  </button>
                                  <button
                                    onClick={() => handleDeleteIndex(idx.id)}
                                    className={`p-1 rounded transition-colors ${
                                      isDark ? 'hover:bg-red-500/20 text-gray-400 hover:text-red-400' : 'hover:bg-red-50 text-gray-600 hover:text-red-600'
                                    }`}
                                    title="Delete index"
                                  >
                                    <Trash2 className="w-3.5 h-3.5" />
                                  </button>
                                </div>
                              </td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </div>

                  {/* Index Edit Form Modal */}
                  <AnimatePresence>
                    {showIndexForm && editingIndex && (
                      <motion.div
                        initial={{ opacity: 0 }}
                        animate={{ opacity: 1 }}
                        exit={{ opacity: 0 }}
                        className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50"
                        onClick={() => setShowIndexForm(false)}
                      >
                        <motion.div
                          initial={{ scale: 0.95, opacity: 0 }}
                          animate={{ scale: 1, opacity: 1 }}
                          exit={{ scale: 0.95, opacity: 0 }}
                          onClick={(e) => e.stopPropagation()}
                          className={`w-full max-w-md rounded-lg shadow-xl ${
                            isDark ? 'bg-zinc-900 border border-zinc-800' : 'bg-white border border-gray-200'
                          }`}
                        >
                          <div className={`p-4 border-b ${isDark ? 'border-zinc-800' : 'border-gray-200'}`}>
                            <h3 className={`text-sm font-semibold ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>
                              {indexes.some(i => i.id === editingIndex.id) ? 'Edit Index' : 'Add New Index'}
                            </h3>
                          </div>
                          <div className="p-4 space-y-3">
                            <div>
                              <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                                Index Name <span className="text-red-500">*</span>
                              </label>
                              <input
                                type="text"
                                value={editingIndex.name}
                                onChange={(e) => setEditingIndex({ ...editingIndex, name: e.target.value })}
                                className={`w-full px-3 py-2 text-xs rounded-md border ${
                                  isDark ? 'bg-zinc-800 border-zinc-700 text-white' : 'bg-white border-gray-300 text-gray-900'
                                } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
                                placeholder="idx_table_column"
                              />
                            </div>
                            <div>
                              <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                                Columns <span className="text-red-500">*</span>
                              </label>
                              <input
                                type="text"
                                value={Array.isArray(editingIndex.columns) ? editingIndex.columns.join(', ') : editingIndex.columns}
                                onChange={(e) => setEditingIndex({ ...editingIndex, columns: e.target.value.split(',').map((s: string) => s.trim()) })}
                                className={`w-full px-3 py-2 text-xs rounded-md border ${
                                  isDark ? 'bg-zinc-800 border-zinc-700 text-white' : 'bg-white border-gray-300 text-gray-900'
                                } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
                                placeholder="column1, column2"
                              />
                            </div>
                            <div className="grid grid-cols-2 gap-3">
                              <div>
                                <label className={`block text-xs font-medium mb-1.5 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                                  Index Type
                                </label>
                                <select
                                  value={editingIndex.type}
                                  onChange={(e) => setEditingIndex({ ...editingIndex, type: e.target.value })}
                                  className={`w-full px-3 py-2 text-xs rounded-md border ${
                                    isDark ? 'bg-zinc-800 border-zinc-700 text-white' : 'bg-white border-gray-300 text-gray-900'
                                  } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
                                >
                                  <option>BTREE</option>
                                  <option>HASH</option>
                                  <option>GIST</option>
                                  <option>GIN</option>
                                </select>
                              </div>
                              <div className="flex items-end">
                                <div className="flex items-center gap-2">
                                  <input
                                    type="checkbox"
                                    id="isUnique"
                                    checked={editingIndex.isUnique}
                                    onChange={(e) => setEditingIndex({ ...editingIndex, isUnique: e.target.checked })}
                                    className="rounded w-4 h-4"
                                  />
                                  <label htmlFor="isUnique" className={`text-xs ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                                    Unique
                                  </label>
                                </div>
                              </div>
                            </div>
                          </div>
                          <div className={`p-4 border-t flex justify-end gap-2 ${isDark ? 'border-zinc-800' : 'border-gray-200'}`}>
                            <button
                              onClick={() => setShowIndexForm(false)}
                              className={`px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${
                                isDark ? 'bg-zinc-800 hover:bg-zinc-700 text-gray-300' : 'bg-gray-100 hover:bg-gray-200 text-gray-700'
                              }`}
                            >
                              Cancel
                            </button>
                            <button
                              onClick={handleSaveIndex}
                              className={`px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${
                                isDark ? 'bg-indigo-500 hover:bg-indigo-600 text-white' : 'bg-indigo-600 hover:bg-indigo-700 text-white'
                              }`}
                            >
                              Save Index
                            </button>
                          </div>
                        </motion.div>
                      </motion.div>
                    )}
                  </AnimatePresence>
                </div>
              )}

              {selectedItem.type === 'table' && activeTab === 'display' && (
                <div className="space-y-2">
                  <div className="flex items-center gap-2">
                    <input type="checkbox" id="showInDiagram" defaultChecked className="rounded" />
                    <label htmlFor="showInDiagram" className={`text-xs ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                      Show in Diagram
                    </label>
                  </div>
                  <div className="flex items-center gap-2">
                    <input type="checkbox" id="expandColumns" className="rounded" />
                    <label htmlFor="expandColumns" className={`text-xs ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                      Expand Columns
                    </label>
                  </div>
                </div>
              )}

              {/* Relationship Properties */}
              {selectedItem.type === 'relationship' && activeTab === 'general' && (
                <div className="space-y-2">
                  <div>
                    <label className={`block text-xs font-medium mb-1 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                      Relationship Type
                    </label>
                    <select
                      className={`w-full px-2 py-1.5 text-xs rounded border ${
                        isDark ? 'bg-zinc-800 border-zinc-600 text-white' : 'bg-white border-gray-300 text-gray-900'
                      }`}
                    >
                      <option value="1:N">One to Many</option>
                      <option value="1:1">One to One</option>
                      <option value="N:M">Many to Many</option>
                    </select>
                  </div>
                </div>
              )}

              {selectedItem.type === 'relationship' && activeTab === 'cardinality' && (
                <div className={`text-xs ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                  <p>Cardinality: 1:N (One to Many)</p>
                  <p className="mt-2">Source: Users (1)</p>
                  <p>Target: Orders (N)</p>
                </div>
              )}
            </div>
          </div>
        </div>
      </div>
    );
  };

  return (
    <motion.div
      key="properties"
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      exit={{ opacity: 0, y: -20 }}
      transition={{ duration: 0.3, ease: 'easeOut' }}
      className={`flex-1 flex overflow-hidden ${isDark ? 'bg-zinc-950' : 'bg-gray-100'}`}
    >
      {/* Left: Enhanced Model Explorer Tree */}
      <div className={`w-64 border-r overflow-hidden flex flex-col ${
        isDark ? 'border-zinc-800 bg-zinc-950' : 'border-gray-200 bg-white'
      }`}>
        {/* Header with title */}
        <div className={`px-3 py-2.5 border-b ${isDark ? 'border-zinc-800 bg-zinc-900/50' : 'border-gray-200 bg-gray-50'}`}>
          <div className="flex items-center justify-between">
            <h3 className={`text-xs font-bold tracking-wide ${isDark ? 'text-gray-100' : 'text-gray-900'}`}>
              MODEL EXPLORER
            </h3>
            <button
              className={`p-1 rounded transition-colors ${
                isDark ? 'hover:bg-zinc-800 text-gray-400' : 'hover:bg-gray-200 text-gray-600'
              }`}
              title="Add New"
            >
              <Plus className="w-3.5 h-3.5" />
            </button>
          </div>
        </div>

        {/* Search and Filter */}
        <div className="p-3 space-y-2">
          {/* Search */}
          <div className="relative">
            <Search className={`absolute left-2.5 top-1/2 transform -translate-y-1/2 w-3.5 h-3.5 ${isDark ? 'text-gray-400' : 'text-gray-500'}`} />
            <input
              type="text"
              placeholder="Search model..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className={`w-full pl-8 pr-3 py-1.5 text-xs rounded-md border transition-all duration-200 ${
                isDark ? 'bg-zinc-800 border-zinc-700 text-gray-100 placeholder-gray-500 focus:border-indigo-500 focus:bg-zinc-800/80'
                       : 'bg-white border-gray-300 text-gray-900 placeholder-gray-400 focus:border-indigo-500 focus:bg-gray-50'
              } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
            />
          </div>

          {/* Filter Dropdown */}
          <select
            value={filterType}
            onChange={(e) => setFilterType(e.target.value as any)}
            className={`w-full px-2.5 py-1.5 text-xs rounded-md border transition-all ${
              isDark ? 'bg-zinc-800 border-zinc-700 text-gray-100 focus:border-indigo-500'
                     : 'bg-white border-gray-300 text-gray-900 focus:border-indigo-500'
            } focus:outline-none focus:ring-2 focus:ring-indigo-500/20`}
          >
            <option value="all">Show: All</option>
            <option value="tables">Show: Tables Only</option>
            <option value="columns">Show: Columns Only</option>
            <option value="relationships">Show: Relationships Only</option>
          </select>
        </div>

        {/* Tree Items - Scrollable */}
        <div className="flex-1 overflow-y-auto px-3 pb-3">
          <div className="space-y-0.5">
            {treeData.map((item) => (
              <TreeItem key={item.id} item={item} />
            ))}
          </div>
        </div>
      </div>

      {/* Right: Context-aware Properties */}
      <div className={`flex-1 overflow-hidden ${isDark ? 'bg-zinc-900' : 'bg-white'}`}>
        {renderPropertiesContent()}
      </div>
    </motion.div>
  );
}

// Right Properties Panel Component - Context-aware properties panel
function RightPropertiesPanel({ table, isDark }: { table?: Table; isDark: boolean }) {
  const [activeTab, setActiveTab] = useState('general');

  // Table tabs
  const tableTabs = [
    { id: 'general', label: 'General', icon: FileText },
    { id: 'columns', label: 'Columns', icon: Table2 },
    { id: 'keys', label: 'Keys', icon: KeyRound },
    { id: 'display', label: 'Display', icon: Eye }
  ];

  // Model tabs (when no table selected)
  const modelTabs = [
    { id: 'general', label: 'General', icon: FileText },
    { id: 'tables', label: 'Tables', icon: Table2 },
    { id: 'settings', label: 'Settings', icon: Settings }
  ];

  const tabs = table ? tableTabs : modelTabs;

  if (!table) {
    // Model Properties
    return (
      <div className="flex h-full">
        {/* Left Icon Strip */}
        <div className={`w-6 border-r transition-colors flex flex-col ${
          isDark ? 'bg-zinc-900 border-zinc-800' : 'bg-white border-gray-200'
        }`}>
          {modelTabs.map((tab) => (
            <div
              key={tab.id}
              onClick={() => setActiveTab(tab.id)}
              className={`h-8 flex items-center justify-center cursor-pointer transition-all duration-200 ${
                activeTab === tab.id
                  ? `${isDark ? 'bg-indigo-500 text-white' : 'bg-indigo-600 text-white'} shadow-sm`
                  : `${isDark ? 'text-gray-400 hover:text-gray-100 hover:bg-zinc-800/50' : 'text-gray-600 hover:text-gray-900 hover:bg-indigo-50/50'}`
              }`}
              title={tab.label}
              style={{ marginBottom: '1px' }}
            >
              <tab.icon className="w-3.5 h-3.5" />
            </div>
          ))}
        </div>

        {/* Main Content Area */}
        <div className={`flex-1 overflow-y-auto transition-colors ${
          isDark ? 'bg-zinc-900' : 'bg-white'
        }`}>
          {/* Context Header */}
          <div className={`p-2 border-b transition-colors ${
            isDark ? 'border-zinc-800 bg-zinc-900' : 'border-gray-200 bg-gray-50'
          }`}>
            <div className="flex items-center gap-2">
              {React.createElement(modelTabs.find(tab => tab.id === activeTab)!.icon, {
                className: `w-4 h-4 ${isDark ? 'text-indigo-400' : 'text-indigo-600'}`
              })}
              <h2 className={`text-xs font-semibold ${
                isDark ? 'text-gray-100' : 'text-gray-900'
              }`}>
                {modelTabs.find(t => t.id === activeTab)?.label} Properties
              </h2>
            </div>
            <p className={`text-xs mt-1 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
              Data Model
            </p>
          </div>

          {/* Content */}
          <div className="p-2 space-y-2">
            {activeTab === 'general' && (
              <div className="space-y-2">
                <div>
                  <label className={`block text-xs font-medium mb-1 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                    Model Name
                  </label>
                  <input
                    type="text"
                    defaultValue="Data Model"
                    className={`w-full px-2 py-1 text-xs rounded border ${
                      isDark ? 'bg-zinc-800 border-zinc-600 text-white' : 'bg-white border-gray-300 text-gray-900'
                    }`}
                  />
                </div>
                <div>
                  <label className={`block text-xs font-medium mb-1 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                    Description
                  </label>
                  <textarea
                    rows={2}
                    className={`w-full px-2 py-1 text-xs rounded border ${
                      isDark ? 'bg-zinc-800 border-zinc-600 text-white' : 'bg-white border-gray-300 text-gray-900'
                    }`}
                    placeholder="Model description..."
                  />
                </div>
              </div>
            )}
            {activeTab === 'tables' && (
              <div className={`text-xs ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
                <p>Total Tables: 2</p>
                <p className="mt-1">Add tables from the toolbar</p>
              </div>
            )}
            {activeTab === 'settings' && (
              <div className="space-y-2">
                <div className="flex items-center gap-2">
                  <input type="checkbox" id="autoLayout" className="rounded" />
                  <label htmlFor="autoLayout" className={`text-xs ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                    Auto Layout
                  </label>
                </div>
                <div className="flex items-center gap-2">
                  <input type="checkbox" id="showGrid" defaultChecked className="rounded" />
                  <label htmlFor="showGrid" className={`text-xs ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                    Show Grid
                  </label>
                </div>
              </div>
            )}
          </div>
        </div>
      </div>
    );
  }

  // Table Properties
  return (
    <div className="flex h-full">
      {/* Left Icon Strip */}
      <div className={`w-6 border-r transition-colors flex flex-col ${
        isDark ? 'bg-zinc-900 border-zinc-800' : 'bg-white border-gray-200'
      }`}>
        {tableTabs.map((tab) => (
          <div
            key={tab.id}
            onClick={() => setActiveTab(tab.id)}
            className={`h-8 flex items-center justify-center cursor-pointer transition-all duration-200 ${
              activeTab === tab.id
                ? `${isDark ? 'bg-indigo-500 text-white' : 'bg-indigo-600 text-white'} shadow-sm`
                : `${isDark ? 'text-gray-400 hover:text-gray-100 hover:bg-zinc-800/50' : 'text-gray-600 hover:text-gray-900 hover:bg-indigo-50/50'}`
            }`}
            title={tab.label}
            style={{ marginBottom: '1px' }}
          >
            <tab.icon className="w-3.5 h-3.5" />
          </div>
        ))}
      </div>

      {/* Main Content Area */}
      <div className={`flex-1 overflow-y-auto transition-colors ${
        isDark ? 'bg-zinc-900' : 'bg-white'
      }`}>
        {/* Context Header */}
        <div className={`p-2 border-b transition-colors ${
          isDark ? 'border-zinc-800 bg-zinc-900' : 'border-gray-200 bg-gray-50'
        }`}>
          <div className="flex items-center gap-2">
            {React.createElement(tableTabs.find(tab => tab.id === activeTab)!.icon, {
              className: `w-4 h-4 ${isDark ? 'text-indigo-400' : 'text-indigo-600'}`
            })}
            <h2 className={`text-xs font-semibold ${
              isDark ? 'text-gray-100' : 'text-gray-900'
            }`}>
              {tableTabs.find(t => t.id === activeTab)?.label} Properties
            </h2>
          </div>
          <p className={`text-xs mt-1 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>
            {table.name}
          </p>
        </div>

        {/* Content */}
        <div className="p-2 space-y-2">
          {activeTab === 'general' && (
            <div className="space-y-2">
              <div>
                <label className={`block text-xs font-medium mb-1 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                  Table Name
                </label>
                <input
                  type="text"
                  defaultValue={table.name}
                  className={`w-full px-2 py-1 text-xs rounded border ${
                    isDark ? 'bg-zinc-800 border-zinc-600 text-white' : 'bg-white border-gray-300 text-gray-900'
                  }`}
                />
              </div>
              <div>
                <label className={`block text-xs font-medium mb-1 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                  Definition
                </label>
                <textarea
                  rows={2}
                  className={`w-full px-2 py-1 text-xs rounded border ${
                    isDark ? 'bg-zinc-800 border-zinc-600 text-white' : 'bg-white border-gray-300 text-gray-900'
                  }`}
                  placeholder="Table definition..."
                />
              </div>
            </div>
          )}

          {activeTab === 'columns' && (
            <div>
              <div className="flex items-center justify-between mb-2">
                <label className={`text-xs font-medium ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                  Columns ({table.columns.length})
                </label>
                <button className={`text-xs ${isDark ? 'text-indigo-400 hover:text-indigo-300' : 'text-indigo-600 hover:text-indigo-700'}`}>
                  <Plus className="w-3 h-3 inline mr-1" />
                  Add
                </button>
              </div>
              <div className="space-y-1 max-h-64 overflow-y-auto">
                {table.columns.map(col => (
                  <div
                    key={col.id}
                    className={`px-2 py-1.5 rounded text-xs ${
                      isDark ? 'bg-zinc-800' : 'bg-gray-100'
                    }`}
                  >
                    <div className="flex items-center justify-between mb-1">
                      <div className="flex items-center gap-1.5">
                        {col.isPK && (
                          <span className="px-1 py-0.5 bg-amber-500/20 text-amber-400 rounded text-xs font-bold">PK</span>
                        )}
                        <span className={`font-medium ${isDark ? 'text-gray-200' : 'text-gray-800'}`}>{col.name}</span>
                      </div>
                      <span className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-400'}`}>{col.dataType}</span>
                    </div>
                    <div className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>
                      {!col.isNullable && 'NOT NULL'}
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}

          {activeTab === 'keys' && (
            <div className="space-y-2">
              <div>
                <label className={`block text-xs font-medium mb-1 ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                  Primary Key
                </label>
                <div className={`px-2 py-1.5 rounded text-xs ${isDark ? 'bg-zinc-800 text-gray-300' : 'bg-gray-100 text-gray-700'}`}>
                  {table.columns.filter(c => c.isPK).map(c => c.name).join(', ') || 'None'}
                </div>
              </div>
            </div>
          )}

          {activeTab === 'display' && (
            <div className="space-y-2">
              <div className="flex items-center gap-2">
                <input type="checkbox" id="showInDiagram" defaultChecked className="rounded" />
                <label htmlFor="showInDiagram" className={`text-xs ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                  Show in Diagram
                </label>
              </div>
              <div className="flex items-center gap-2">
                <input type="checkbox" id="expandColumns" className="rounded" />
                <label htmlFor="expandColumns" className={`text-xs ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>
                  Expand Columns
                </label>
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
